

=============================
FILE: textutils-react/src/App.tsx
=============================
import AppRoutes from "./routes/AppRoutes";

export default function App() {
  return <AppRoutes />;
}



=============================
FILE: textutils-react/src/admin/components/AdminNavbar.tsx
=============================
import { NavLink } from "react-router-dom";
import { useLogout } from "../../auth/hooks/useLogout";

export default function AdminNavbar() {
  const logout = useLogout();

  const toggleSidebar = () => {
    document.body.classList.toggle("sidebar-collapse");
  };

  return (
    <nav className="main-header navbar navbar-expand navbar-white navbar-light">
      {/* ================= LEFT ================= */}
      <ul className="navbar-nav">
        <li className="nav-item">
          <button
            className="nav-link btn btn-link"
            onClick={toggleSidebar}
            type="button"
          >
            <i className="fas fa-bars" />
          </button>
        </li>
      </ul>

      {/* ================= RIGHT ================= */}
      <ul className="navbar-nav ml-auto align-items-center">
        {/* ðŸ‘¤ USER MENU */}
        <li className="nav-item dropdown">
          <button
            className="nav-link btn btn-link"
            data-toggle="dropdown"
            type="button"
          >
            <i className="fas fa-user-circle" />
          </button>

          <div className="dropdown-menu dropdown-menu-right">
            <NavLink
              to="/admin/profile"
              className="dropdown-item"
            >
              <i className="fas fa-user mr-2" />
              Profile
            </NavLink>

            <div className="dropdown-divider" />

            <button
              className="dropdown-item text-danger"
              onClick={() => logout()}
            >
              <i className="fas fa-sign-out-alt mr-2" />
              Logout
            </button>
          </div>
        </li>
      </ul>
    </nav>
  );
}



=============================
FILE: textutils-react/src/admin/components/AdminSidebar.tsx
=============================
import MenuRenderer from "../../components/MenuRenderer";
import { useGetSidebarQuery } from "../../store/api";
import { useLogout } from "../../auth/hooks/useLogout";
import { SidebarGroup } from "../../types/sidebar";

export default function AdminSidebar() {
  const logout = useLogout();

  // ðŸ”¥ SAFE: always array
  const { data: groups = [] } = useGetSidebarQuery();

  const handleAction = (action?: string) => {
    if (action === "logout") {
      logout("/admin/login");
    }
  };

  return (
    <aside className="main-sidebar sidebar-dark-primary elevation-4">
      <div className="sidebar">
        <nav>
          <ul className="nav nav-pills nav-sidebar flex-column">
            {groups.map((group: SidebarGroup) => (
              <MenuRenderer
                key={group.label}
                group={group}
                onAction={handleAction}
              />
            ))}
          </ul>
        </nav>
      </div>
    </aside>
  );
}



=============================
FILE: textutils-react/src/admin/components/CreateAdminModal.tsx
=============================
import { useState } from "react";
import Modal from "../../components/common/Modal";
import Button from "../../components/common/Button";
import { createAdminService } from "../features/users/user.api";
import { execute } from "../../utils/execute";

type Props = {
  onClose: () => void;
};

export default function CreateAdminModal({ onClose }: Props) {
  const [form, setForm] = useState({
    name: "",
    email: "",
    role: "admin",
  });

  const [loading, setLoading] = useState(false);

  /* ================= SUBMIT ================= */

  const submit = async () => {
    setLoading(true);

    try {
      await execute(
        () => createAdminService(form),
        "Admin created successfully. Password setup email sent."
      );

      onClose();
    } finally {
      setLoading(false);
    }
  };

  /* ================= VIEW ================= */

  return (
    <Modal
      title="Create Admin"
      onClose={onClose}
      onSave={submit}
      saveDisabled={loading}
      saveText={loading ? "Creating..." : "Create"}
    >
      <input
        className="form-control mb-2"
        placeholder="Name"
        value={form.name}
        disabled={loading}
        onChange={(e) =>
          setForm({ ...form, name: e.target.value })
        }
      />

      <input
        className="form-control mb-2"
        placeholder="Email"
        type="email"
        value={form.email}
        disabled={loading}
        onChange={(e) =>
          setForm({ ...form, email: e.target.value })
        }
      />

      <select
        className="form-control"
        value={form.role}
        disabled={loading}
        onChange={(e) =>
          setForm({ ...form, role: e.target.value })
        }
      >
        <option value="admin">Admin</option>
        <option value="manager">Manager</option>
      </select>
    </Modal>
  );
}



=============================
FILE: textutils-react/src/admin/features/Profile/AdminProfilePage.tsx
=============================
import { useAuth } from "../../../auth/hooks/useAuth";

export default function AdminProfilePage() {
  const { user, roles, permissions, isSuperAdmin } = useAuth();

  return (
    <div className="card">
      <div className="card-header">
        <h3>Admin Profile</h3>
      </div>

      <div className="card-body">
        <p>
          <strong>Name:</strong> {user?.name}
        </p>

        <p>
          <strong>Email:</strong> {user?.email}
        </p>

        <p>
          <strong>Roles:</strong> {roles.join(", ")}
        </p>

        <p>
          <strong>Account Type:</strong>{" "}
          {isSuperAdmin ? "Super Admin" : "Admin"}
        </p>

        <hr />

        <h5>Permissions</h5>
        <ul>
          {permissions.map((p) => (
            <li key={p}>{p}</li>
          ))}
        </ul>
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/admin/features/audit/AuditLogsFilters.tsx
=============================
type Props = {
  action?: string;
  onActionChange: (value?: string) => void;
};

export default function AuditLogsFilters({
  action,
  onActionChange,
}: Props) {
  return (
    <div className="mb-3" style={{ maxWidth: 240 }}>
      <select
        className="form-select"
        value={action ?? ""}
        onChange={(e) =>
          onActionChange(e.target.value || undefined)
        }
      >
        <option value="">All actions</option>
        <option value="login">Login</option>
        <option value="logout">Logout</option>
        <option value="role-assigned">Role Assigned</option>
        <option value="permission-changed">Permission Changed</option>
      </select>
    </div>
  );
}



=============================
FILE: textutils-react/src/admin/features/audit/AuditLogsPage.tsx
=============================
import { useState } from "react";
import { useGetAuditLogsQuery } from "@/store/api.audit";
import AuditLogsTable from "./AuditLogsTable";
import AuditLogsFilters from "./AuditLogsFilters";
import Can from "@/components/common/Can";

export default function AuditLogsPage() {
  const [page, setPage] = useState(1);
  const [action, setAction] = useState<string | undefined>();

  const { data, isLoading } = useGetAuditLogsQuery({
    page,
    action,
  });

  return (
    <Can permission="audit-view">
      <section className="content pt-3">
        <div className="container-fluid">
          <h3 className="mb-3">Audit Logs</h3>

          <AuditLogsFilters
            action={action}
            onActionChange={(value) => {
              setPage(1);
              setAction(value);
            }}
          />

          <AuditLogsTable
            logs={data?.data ?? []}
            loading={isLoading}
          />

          {data?.meta && (
            <div className="d-flex justify-content-end mt-3 gap-2">
              <button
                className="btn btn-outline-secondary btn-sm"
                disabled={page <= 1}
                onClick={() => setPage((p) => p - 1)}
              >
                Prev
              </button>

              <button
                className="btn btn-outline-secondary btn-sm"
                disabled={page >= data.meta.last_page}
                onClick={() => setPage((p) => p + 1)}
              >
                Next
              </button>
            </div>
          )}
        </div>
      </section>
    </Can>
  );
}



=============================
FILE: textutils-react/src/admin/features/audit/AuditLogsTable.tsx
=============================
import DataTable from "@/components/common/DataTable";
import type { AuditLog } from "@/types/audit";

type Props = {
  logs: AuditLog[];
  loading: boolean;
};

export default function AuditLogsTable({ logs, loading }: Props) {
  return (
    <DataTable
      isLoading={loading}
      hasData={logs.length > 0}
      colSpan={4}
      columns={
        <tr>
          <th>User</th>
          <th>Action</th>
          <th>IP</th>
          <th>Date</th>
        </tr>
      }
    >
      {logs.map((log) => (
        <tr key={log.id}>
          <td>
            {log.user_name ?? "System"}
            {log.user_email && (
              <div className="text-muted small">
                {log.user_email}
              </div>
            )}
          </td>
          <td>{log.action}</td>
          <td>{log.ip_address ?? "â€”"}</td>
          <td>
            {new Date(log.created_at).toLocaleString()}
          </td>
        </tr>
      ))}
    </DataTable>
  );
}



=============================
FILE: textutils-react/src/admin/features/dashboard/DashboardPage.tsx
=============================
import { useAuth } from "../../../auth/hooks/useAuth";
import { useGetDashboardStatsQuery } from "../../../store/api";
import InfoBox from "../../../ui/InfoBox";
import { ICONS } from "../../../constants/icons";

export default function Dashboard() {
  const { user, permissions } = useAuth();
  const { data: stats } = useGetDashboardStatsQuery();

  return (
    <section className="content pt-3">
      <div className="container-fluid">
        <h3 className="mb-3">Admin Dashboard</h3>

        <div className="row">
          <div className="col-md-3 col-sm-6">
            <InfoBox
              title="Total Users"
              value={stats?.total_users ?? 0}
              icon={ICONS.USER}
              color="primary"
            />
          </div>

          <div className="col-md-3 col-sm-6">
            <InfoBox
              title="Permissions"
              value={permissions.length}
              icon={ICONS.PERMISSION}
              color="success"
            />
          </div>

          <div className="col-md-3 col-sm-6">
            <InfoBox
              title="Roles"
              value={user?.roles.length || 0}
              icon={ICONS.ROLE}
              color="warning"
            />
          </div>
        </div>
      </div>
    </section>
  );
}



=============================
FILE: textutils-react/src/admin/features/permissions/PermissionsPage.tsx
=============================
import { memo } from "react";
import Modal from "../../../components/common/Modal";
import RowActions from "../../../components/common/RowActions";
import Button from "../../../components/common/Button";
import PageHeader from "../../../components/common/PageHeader";
import DataTable from "../../../components/common/DataTable";

import Card from "../../../ui/Card";
import CardHeader from "../../../ui/CardHeader";
import CardBody from "../../../ui/CardBody";

import { useAppModal } from "../../../context/AppModalContext";
import { useBackendForm } from "../../../hooks/useBackendForm";
import { useConfirmDelete } from "../../../hooks/useConfirmDelete";
import { useAuth } from "../../../auth/hooks/useAuth";

import {
  useGetPermissionsQuery,
  useCreatePermissionMutation,
  useUpdatePermissionMutation,
  useDeletePermissionMutation,
} from "../../../store/api";

import { execute } from "../../../utils/execute";
import type { Permission } from "../../../types/models";

import Can from "../../../components/common/Can";
import { PERMISSIONS } from "../../../constants/permissions";

function PermissionsPage() {
  const confirmDelete = useConfirmDelete();

  const { modalType, modalData, openModal, closeModal } =
    useAppModal<Permission>();

  /* âœ… FLAT PERMISSIONS ONLY */
  const { data: permissions = [], isLoading } =
    useGetPermissionsQuery({ flat: true });

  const [createPermission] = useCreatePermissionMutation();
  const [updatePermission] = useUpdatePermissionMutation();
  const [deletePermission] = useDeletePermissionMutation();

  const {
    values,
    errors,
    loading,
    setLoading,
    setField,
    handleError,
    reset,
  } = useBackendForm({
    name: "",
    group_name: "",
  });

  const { can } = useAuth();

  /* ================= SAVE ================= */

  const save = async () => {
    try {
      setLoading(true);

      await execute(
        () =>
          modalData?.id
            ? updatePermission({
                id: modalData.id,
                name: values.name,
                group_name: values.group_name,
              }).unwrap()
            : createPermission(values).unwrap(),
        modalData?.id
          ? "Permission updated"
          : "Permission created"
      );

      closeModal();
      reset();
    } catch (e) {
      handleError(e);
    } finally {
      setLoading(false);
    }
  };

  /* ================= DELETE ================= */

  const handleDelete = (permission: Permission) =>
    confirmDelete(
      "Are you sure you want to delete this permission?",
      async () => {
        await execute(
          () => deletePermission(permission.id).unwrap(),
          "Permission deleted"
        );
      }
    );

  /* ================= ROW ACTIONS ================= */

  const getRowActions = (permission: Permission) => [
    {
      key: "edit",
      label: "Edit",
      show: can(PERMISSIONS.PERMISSION.MANAGE),
      onClick: () => {
        setField("name", permission.name);
        setField("group_name", permission.group_name);
        openModal("permission", permission);
      },
    },
    {
      key: "delete",
      label: "Delete",
      variant: "danger" as const,
      show: can(PERMISSIONS.PERMISSION.MANAGE),
      onClick: () => handleDelete(permission),
    },
  ];

  /* ================= VIEW ================= */

  return (
    <section className="content pt-3">
      <div className="container-fluid">
        <PageHeader
          title="Permissions"
          action={
            <Can permission={PERMISSIONS.PERMISSION.MANAGE}>
              <Button
                label="+ Add Permission"
                onClick={() => {
                  reset();
                  openModal("permission");
                }}
              />
            </Can>
          }
        />

        <Card>
          <CardHeader title="Permissions List" />
          <CardBody className="p-0">
            <DataTable
              isLoading={isLoading}
              colSpan={3}
              hasData={permissions.length > 0}
              columns={
                <tr>
                  <th>Name</th>
                  <th>Group</th>
                  <th className="text-right">Actions</th>
                </tr>
              }
            >
              {permissions.map((permission) => (
                <tr key={permission.id}>
                  <td>{permission.name}</td>
                  <td>{permission.group_name}</td>
                  <td className="text-right">
                    <RowActions actions={getRowActions(permission)} />
                  </td>
                </tr>
              ))}
            </DataTable>
          </CardBody>
        </Card>

        {modalType === "permission" && (
          <Modal
            title={
              modalData?.id ? "Edit Permission" : "Add Permission"
            }
            onClose={closeModal}
            onSave={save}
            saveDisabled={loading}
          >
            <input
              className={`form-control mb-2 ${
                errors.name ? "is-invalid" : ""
              }`}
              value={values.name}
              onChange={(e) =>
                setField("name", e.target.value)
              }
              placeholder="Permission name"
            />

            <input
              className={`form-control ${
                errors.group_name ? "is-invalid" : ""
              }`}
              value={values.group_name}
              onChange={(e) =>
                setField("group_name", e.target.value)
              }
              placeholder="Group (User / Role / System)"
            />
          </Modal>
        )}
      </div>
    </section>
  );
}

export default memo(PermissionsPage);



=============================
FILE: textutils-react/src/admin/features/roles/RolesPage.tsx
=============================
import { memo } from "react";
import Modal from "../../../components/common/Modal";
import RolePermissionModal from "../../../components/RolePermissionModal";
import RowActions from "../../../components/common/RowActions";
import Button from "../../../components/common/Button";
import PageHeader from "../../../components/common/PageHeader";
import DataTable from "../../../components/common/DataTable";

import Card from "../../../ui/Card";
import CardHeader from "../../../ui/CardHeader";
import CardBody from "../../../ui/CardBody";

import { useAppModal } from "../../../context/AppModalContext";
import { useBackendForm } from "../../../hooks/useBackendForm";
import { useConfirmDelete } from "../../../hooks/useConfirmDelete";
import { useAuth } from "../../../auth/hooks/useAuth";

import {
  useGetRolesQuery,
  useCreateRoleMutation,
  useUpdateRoleMutation,
  useDeleteRoleMutation,
} from "../../../store/api";

import { execute } from "../../../utils/execute";
import type { Role } from "../../../types/models";

import Can from "../../../components/common/Can";
import { PERMISSIONS } from "../../../constants/permissions";

function RolesPage() {
  const confirmDelete = useConfirmDelete();

  const { modalType, modalData, openModal, closeModal } =
    useAppModal<Role>();

  const { data: roles = [], isLoading } = useGetRolesQuery();

  const [createRole] = useCreateRoleMutation();
  const [updateRole] = useUpdateRoleMutation();
  const [deleteRole] = useDeleteRoleMutation();

  const {
    values,
    errors,
    loading,
    setLoading,
    setField,
    handleError,
    reset,
  } = useBackendForm({ name: "" });

  const { can } = useAuth();

  /* ================= SAVE ================= */

  const save = async () => {
    try {
      setLoading(true);

      await execute(
        () =>
          modalData?.id
            ? updateRole({
                id: modalData.id,
                name: values.name,
              }).unwrap()
            : createRole(values).unwrap(),
        modalData?.id ? "Role updated" : "Role created"
      );

      closeModal();
      reset();
    } catch (e) {
      handleError(e);
    } finally {
      setLoading(false);
    }
  };

  /* ================= DELETE ================= */

  const handleDelete = (role: Role) =>
    confirmDelete(
      "Are you sure you want to delete this role?",
      async () => {
        await execute(
          () => deleteRole(role.id).unwrap(),
          "Role deleted"
        );
      }
    );

  /* ================= ROW ACTIONS ================= */

  const getRowActions = (role: Role) => [
    {
      key: "permissions",
      label: "Assign Permissions",
      show: can(PERMISSIONS.ROLE.MANAGE),
      onClick: () => openModal("permission", role),
    },
    {
      key: "edit",
      label: "Edit",
      show: can(PERMISSIONS.ROLE.MANAGE),
      onClick: () => {
        setField("name", role.name);
        openModal("role-edit", role);
      },
    },
    {
      key: "delete",
      label: "Delete",
      variant: "danger" as const,
      show: can(PERMISSIONS.ROLE.MANAGE),
      onClick: () => handleDelete(role),
    },
  ];

  /* ================= VIEW ================= */

  return (
    <section className="content pt-3">
      <div className="container-fluid">
        <PageHeader
          title="Roles"
          action={
            <Can permission={PERMISSIONS.ROLE.MANAGE}>
              <Button
                label="+ Add Role"
                onClick={() => {
                  reset();
                  openModal("role-add");
                }}
              />
            </Can>
          }
        />

        <Card>
          <CardHeader title="Roles List" />
          <CardBody className="p-0">
            <DataTable
              isLoading={isLoading}
              colSpan={2}
              hasData={roles.length > 0}
              columns={
                <tr>
                  <th>Name</th>
                  <th className="text-right" style={{ width: 260 }}>
                    Actions
                  </th>
                </tr>
              }
            >
              {roles.map((role) => (
                <tr key={role.id}>
                  <td>{role.name}</td>
                  <td className="text-right">
                    <RowActions actions={getRowActions(role)} />
                  </td>
                </tr>
              ))}
            </DataTable>
          </CardBody>
        </Card>

        {(modalType === "role-add" || modalType === "role-edit") && (
          <Modal
            title={
              modalType === "role-edit" ? "Edit Role" : "Add Role"
            }
            onClose={closeModal}
            onSave={save}
            saveDisabled={loading}
            saveText={modalType === "role-edit" ? "Update" : "Save"}
          >
            <input
              className={`form-control ${
                errors.name ? "is-invalid" : ""
              }`}
              value={values.name}
              onChange={(e) => setField("name", e.target.value)}
              disabled={loading}
              placeholder="Role name"
            />

            {errors.name && (
              <div className="invalid-feedback">
                {errors.name[0]}
              </div>
            )}
          </Modal>
        )}

        {modalType === "permission" && modalData && (
          <RolePermissionModal
            role={modalData}
            onClose={closeModal}
          />
        )}
      </div>
    </section>
  );
}

export default memo(RolesPage);



=============================
FILE: textutils-react/src/admin/features/users/UserFormModal.tsx
=============================
import Modal from "../../../components/common/Modal";
import { useBackendForm } from "../../../hooks/useBackendForm";
import { useCreateUserMutation } from "../../../store/api";
import { execute } from "../../../utils/execute";

type Props = {
  onClose: () => void;
  onSaved: () => void;
};

export default function UserFormModal({
  onClose,
  onSaved,
}: Props) {
  const {
    values,
    errors,
    loading,
    setField,
    handleError,
    reset,
  } = useBackendForm({
    name: "",
    email: "",
  });

  const [createUser] = useCreateUserMutation();

  /* ================= SAVE ================= */

  const save = async () => {
    try {
      await execute(
        () => createUser(values).unwrap(),
        "User created successfully. Password setup email sent."
      );

      reset();
      onSaved();
    } catch (e) {
      handleError(e); // backend validation only
    }
  };

  /* ================= VIEW ================= */

  return (
    <Modal
      title="Add User"
      onClose={onClose}
      onSave={save}
      saveDisabled={loading}
      saveText={loading ? "Creating..." : "Create"}
    >
      <input
        className={`form-control mb-2 ${
          errors.name ? "is-invalid" : ""
        }`}
        placeholder="Name"
        value={values.name}
        onChange={(e) => setField("name", e.target.value)}
        disabled={loading}
      />
      {errors.name && (
        <div className="invalid-feedback">
          {errors.name[0]}
        </div>
      )}

      <input
        className={`form-control mb-2 ${
          errors.email ? "is-invalid" : ""
        }`}
        type="email"
        placeholder="Email"
        value={values.email}
        onChange={(e) =>
          setField("email", e.target.value)
        }
        disabled={loading}
      />
      {errors.email && (
        <div className="invalid-feedback">
          {errors.email[0]}
        </div>
      )}
    </Modal>
  );
}



=============================
FILE: textutils-react/src/admin/features/users/UserPermissionModal.tsx
=============================
import { memo } from "react";
import Modal from "../../../components/common/Modal";
import { useConfirmDelete } from "../../../hooks/useConfirmDelete";

import {
  useGetUserPermissionsQuery,
  useAssignUserPermissionsMutation,
} from "../../../store/api";

import { execute } from "../../../utils/execute";
import type { User } from "../../../types/models";

type Props = {
  user: User;
  onClose: () => void;
};

function UserPermissionModal({ user, onClose }: Props) {
  const confirmDelete = useConfirmDelete();

  const { data, isLoading } = useGetUserPermissionsQuery(user.id);

  const [assignPermissions, { isLoading: saving }] =
    useAssignUserPermissionsMutation();

  const assigned = data?.assigned ?? [];
  const permissions = data?.permissions ?? [];

  const togglePermission = async (permission: string) => {
    const updated = assigned.includes(permission)
      ? assigned.filter((p) => p !== permission)
      : [...assigned, permission];

    await execute(
      () =>
        assignPermissions({
          id: user.id,
          permissions: updated,
        }).unwrap(),
      "Permissions updated"
    );
  };

  const handleReset = () =>
    confirmDelete(
      "Are you sure you want to remove all permissions?",
      async () => {
        await execute(
          () =>
            assignPermissions({
              id: user.id,
              permissions: [],
            }).unwrap(),
          "Permissions cleared"
        );
      }
    );

  return (
    <Modal
      title={`Permissions â€“ ${user.name}`}
      onClose={onClose}
      saveDisabled
    >
      {isLoading ? (
        <p className="text-muted">Loading permissionsâ€¦</p>
      ) : (
        <>
          <div className="mb-3">
            {permissions.map((permission) => (
              <div
                key={permission.name}
                className="form-check mb-2"
              >
                <input
                  type="checkbox"
                  className="form-check-input"
                  id={permission.name}
                  checked={assigned.includes(permission.name)}
                  disabled={saving}
                  onChange={() =>
                    togglePermission(permission.name)
                  }
                />
                <label
                  className="form-check-label"
                  htmlFor={permission.name}
                >
                  {permission.name}
                </label>
              </div>
            ))}
          </div>

          {assigned.length > 0 && (
            <button
              type="button"
              className="btn btn-sm btn-outline-danger"
              disabled={saving}
              onClick={handleReset}
            >
              Remove All Permissions
            </button>
          )}
        </>
      )}
    </Modal>
  );
}

export default memo(UserPermissionModal);



=============================
FILE: textutils-react/src/admin/features/users/UserRoleModal.tsx
=============================
import { useEffect, useState } from "react";
import Modal from "../../../components/common/Modal";
import {
  useGetRolesQuery,
  useAssignUserRolesMutation,
} from "../../../store/api";
import { execute } from "../../../utils/execute";
import type { User } from "../../../types/models";

type Props = {
  user: User;
  onClose: () => void;
  onSaved: () => void;
};

export default function UserRoleModal({
  user,
  onClose,
  onSaved,
}: Props) {
  const [selected, setSelected] = useState<string[]>([]);

  const { data: roles = [] } = useGetRolesQuery();
  const [assignUserRoles, { isLoading }] =
    useAssignUserRolesMutation();

  /* ðŸ” RESET ON OPEN (CRITICAL FIX) */
  useEffect(() => {
    setSelected(user.roles ?? []);
  }, [user.id, user.roles]);

  const toggle = (role: string) => {
    setSelected((prev) =>
      prev.includes(role)
        ? prev.filter((r) => r !== role)
        : [...prev, role]
    );
  };

  const save = async () => {
    if (selected.includes("super-admin")) return;

    await execute(
      () =>
        assignUserRoles({
          id: user.id,
          roles: selected,
        }).unwrap(),
      "Roles assigned successfully"
    );

    onSaved(); // ðŸ”¥ refresh users list
    onClose();
  };

  return (
    <Modal
      title={`Assign Roles â€“ ${user.name}`}
      onClose={onClose}
      onSave={save}
      saveDisabled={isLoading}
      saveText={isLoading ? "Saving..." : "Assign"}
      size="lg"
    >
      <div className="row">
        {roles.map((r: any) => (
          <div key={r.id} className="col-md-4">
            <div className="form-check">
              <input
                type="checkbox"
                className="form-check-input"
                checked={selected.includes(r.name)}
                onChange={() => toggle(r.name)}
                disabled={isLoading || r.name === "super-admin"}
              />
              <label className="form-check-label">
                {r.name}
              </label>
            </div>
          </div>
        ))}
      </div>
    </Modal>
  );
}



=============================
FILE: textutils-react/src/admin/features/users/UsersPage.tsx
=============================
import { memo } from "react";
import { useAppModal } from "../../../context/AppModalContext";
import { useConfirmDelete } from "../../../hooks/useConfirmDelete";
import { useAuth } from "../../../auth/hooks/useAuth";

import PageHeader from "../../../components/common/PageHeader";
import DataTable from "../../../components/common/DataTable";
import RowActions from "../../../components/common/RowActions";
import Button from "../../../components/common/Button";
import Can from "../../../components/common/Can";
import StatusToggle from "../../../components/common/StatusToggle";

import Card from "../../../ui/Card";
import CardHeader from "../../../ui/CardHeader";
import CardBody from "../../../ui/CardBody";

import UserFormModal from "./UserFormModal";
import UserRoleModal from "./UserRoleModal";
import UserPermissionModal from "./UserPermissionModal";
import Pagination from "../../../components/common/Pagination";
import { usePagination } from "../../../hooks/usePagination";

import { PERMISSIONS } from "../../../constants/permissions";
import { ICONS } from "../../../constants/icons";

import {
  useGetUsersQuery,
  useDeleteUserMutation,
  useRestoreUserMutation,
  useToggleUserStatusMutation,
  useForceUserPasswordResetMutation,
} from "../../../store/api";

import { execute } from "../../../utils/execute";
import type { User } from "../../../types/models";

function UsersPage() {
  const confirmDelete = useConfirmDelete();
  const { modalType, modalData, openModal, closeModal } =
    useAppModal<User | null>();

  const { page, setPage, search, setSearch } = usePagination();

  const { data, isLoading } = useGetUsersQuery(
    { page, search },
    { refetchOnMountOrArgChange: true }
  );

  const users = data?.data ?? [];
  const meta = data?.meta;

  const [deleteUser] = useDeleteUserMutation();
  const [restoreUser] = useRestoreUserMutation();
  const [toggleStatus] = useToggleUserStatusMutation();
  const [forceReset] = useForceUserPasswordResetMutation();

  const { can } = useAuth();

  /* ================= ACTION HANDLERS ================= */

  const handleArchive = (user: User) =>
    confirmDelete(
      "Are you sure you want to archive this user?",
      async () => {
        await execute(
          () => deleteUser(user.id).unwrap(),
          "User archived successfully"
        );
      }
    );

  const handleRestore = async (user: User) => {
    await execute(
      () => restoreUser(user.id).unwrap(),
      "User restored successfully"
    );
  };

  /* ================= ROW ACTIONS ================= */

  const getRowActions = (user: User) => {
    if (user.deleted_at) {
      return [
        {
          key: "restore",
          label: "Restore",
          icon: ICONS.RESTORE,
          variant: "success" as const,
          onClick: () => handleRestore(user),
        },
      ];
    }

    return [
      {
        key: "roles",
        label: "Roles",
        icon: ICONS.ROLE,
        show: can(PERMISSIONS.USER.ASSIGN_ROLE),
        onClick: () => openModal("user-role", user),
      },
      {
        key: "permissions",
        label: "Permissions",
        icon: ICONS.PERMISSION,
        show: can(PERMISSIONS.USER.ASSIGN_PERMISSION),
        onClick: () => openModal("user-permission", user),
      },
      {
        key: "force-reset",
        label: "Force Password Reset",
        icon: ICONS.LOCK,
        variant: "warning" as const,
        show: can(PERMISSIONS.USER.UPDATE),
        onClick: () =>
          execute(
            () => forceReset(user.id).unwrap(),
            "Force password reset updated"
          ),
      },
      {
        key: "archive",
        label: "Archive",
        icon: ICONS.DELETE,
        variant: "danger" as const,
        show: can(PERMISSIONS.USER.DELETE),
        onClick: () => handleArchive(user),
      },
    ];
  };

  /* ================= VIEW ================= */

  return (
    <section className="content pt-3">
      <div className="container-fluid">
        <PageHeader
          title="Users"
          action={
            <Can permission={PERMISSIONS.USER.CREATE}>
              <Button
                label="Add User"
                icon={ICONS.ADD}
                onClick={() => openModal("user-form", null)}
              />
            </Can>
          }
        />

        <div className="mb-3">
          <input
            className="form-control"
            placeholder="Search by name or email..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
          />
        </div>

        <Card>
          <CardHeader title="Users List" />
          <CardBody className="p-0">
            <DataTable
              isLoading={isLoading}
              colSpan={5}
              hasData={users.length > 0}
              columns={
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Roles</th>
                  <th>Status</th>
                  <th className="text-right">Actions</th>
                </tr>
              }
            >
              {users.map((user) => (
                <tr key={user.id}>
                  <td>{user.name}</td>
                  <td>{user.email}</td>
                  <td>{user.roles.join(", ") || "â€”"}</td>
                  <td>
                    {user.deleted_at ? (
                      <span className="badge badge-warning">
                        Archived
                      </span>
                    ) : (
                      <StatusToggle
                        checked={user.is_active}
                        onToggle={() =>
                          execute(
                            () =>
                              toggleStatus(user.id).unwrap(),
                            "User status updated"
                          )
                        }
                      />
                    )}
                  </td>
                  <td className="text-right">
                    <RowActions actions={getRowActions(user)} />
                  </td>
                </tr>
              ))}
            </DataTable>
          </CardBody>
        </Card>

        {meta && (
          <Pagination meta={meta} onPageChange={setPage} />
        )}

        {/* MODALS */}
        {modalType === "user-form" && (
          <UserFormModal
            onClose={closeModal}
            onSaved={closeModal}
          />
        )}

        {modalType === "user-role" && modalData && (
          <UserRoleModal
            user={modalData}
            onClose={closeModal}
            onSaved={closeModal}
          />
        )}

        {modalType === "user-permission" && modalData && (
          <UserPermissionModal
            user={modalData}
            onClose={closeModal}
          />
        )}
      </div>
    </section>
  );
}

export default memo(UsersPage);



=============================
FILE: textutils-react/src/admin/features/users/index.ts
=============================
// pages
export { default as UsersPage } from "./UsersPage";

// modals
export { default as UserFormModal } from "./UserFormModal";
export { default as UserRoleModal } from "./UserRoleModal";
export { default as UserPermissionModal } from "./UserPermissionModal";

// api
export * from "./user.api";



=============================
FILE: textutils-react/src/admin/features/users/user.api.ts
=============================
import api from "../../../api/axios";

export const createAdminService = (data: {
  name: string;
  email: string;
  role: string;
}) => {
  return api.post("/admin/admins", data);
};



=============================
FILE: textutils-react/src/admin/layouts/AdminLayout.tsx
=============================
import { Outlet } from "react-router-dom";
import AdminNavbar from "../components/AdminNavbar";
import AdminSidebar from "../components/AdminSidebar";
import ModalHost from "../../components/common/ModalHost";

export default function AdminLayout() {
  return (
    <div className="wrapper">
      <AdminNavbar />
      <AdminSidebar />

      <div className="content-wrapper">
        <Outlet />
      </div>

      <ModalHost />

      <footer className="main-footer text-center">
        <strong>Admin Panel</strong>
      </footer>
    </div>
  );
}



=============================
FILE: textutils-react/src/admin/routes/admin.routes.tsx
=============================
import { RouteObject, Navigate } from "react-router-dom";
import AdminGuard from "../../guards/AdminGuard";
import AdminLayout from "../layouts/AdminLayout";

import DashboardPage from "../features/dashboard/DashboardPage";
import { UsersPage } from "../features/users";
import RolesPage from "../features/roles/RolesPage";
import PermissionsPage from "../features/permissions/PermissionsPage";
import AdminProfilePage from "../features/profile/AdminProfilePage";

// âœ… AUDIT LOGS
import AuditLogsPage from "../features/audit/AuditLogsPage";

export const adminRoutes: RouteObject[] = [
  {
    path: "/admin",
    element: <AdminGuard />,
    children: [
      {
        element: <AdminLayout />,
        children: [
          { index: true, element: <Navigate to="dashboard" replace /> },

          { path: "dashboard", element: <DashboardPage /> },
          { path: "profile", element: <AdminProfilePage /> },

          // ðŸ”¥ NO PERMISSION AT ROUTE LEVEL
          { path: "users", element: <UsersPage /> },
          { path: "roles", element: <RolesPage /> },
          { path: "permissions", element: <PermissionsPage /> },

          // ðŸ†• AUDIT LOGS
          { path: "audit-logs", element: <AuditLogsPage /> },
        ],
      },
    ],
  },
];



=============================
FILE: textutils-react/src/api/axios.ts
=============================
// src/api/axios.ts

import axios, { AxiosError } from "axios";
import { getStore } from "../store/storeAccessor";
import { logoutThunk } from "../store/authSlice";

/* =====================================================
   AXIOS INSTANCE
   -----------------------------------------------------
   - Used ONLY for:
     â€¢ login
     â€¢ register
     â€¢ forgot / reset password
     â€¢ email verification
   - Refresh token is NOT handled here
===================================================== */

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL,
  timeout: 15000,
  headers: {
    Accept: "application/json",
  },
});

/* =====================================================
   REQUEST INTERCEPTOR
   -----------------------------------------------------
   - Attach token if available
===================================================== */

api.interceptors.request.use((config) => {
  try {
    const store = getStore();
    const token = store.getState().auth.token;

    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
  } catch {
    // store not ready (early boot / edge case)
  }

  return config;
});

/* =====================================================
   RESPONSE INTERCEPTOR
===================================================== */

api.interceptors.response.use(
  (res) => res,

  (error: AxiosError<any>) => {
    const status = error.response?.status;

    /* ================= 401 â†’ FORCE LOGOUT ================= */
    if (status === 401) {
      /**
       * ðŸ”’ RULE:
       * - axios NEVER refreshes token
       * - refresh handled only in RTK Query
       *
       * If axios gets 401 â†’ session is invalid
       */
      forceLogout();
    }

    /* ================= 403 â†’ UNAUTHORIZED ================= */
    if (status === 403) {
      if (
        !window.location.pathname.includes(
          "/admin/unauthorized"
        )
      ) {
        window.location.replace("/admin/unauthorized");
      }
    }

    return Promise.reject(error);
  }
);

/* =====================================================
   HELPERS
===================================================== */

function forceLogout() {
  try {
    const store = getStore();
    store.dispatch(logoutThunk());
  } catch {
    // store may not be ready
  }

  /* ðŸ”¥ Clear ONLY auth-related storage */
  localStorage.removeItem("token");
  localStorage.removeItem("refresh_token");
  localStorage.removeItem("user");
  localStorage.removeItem("permissions");

  /* ðŸ” Hard redirect (safe reset) */
  window.location.replace("/login");
}

export default api;



=============================
FILE: textutils-react/src/auth/LoginForm.tsx
=============================
import { useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { Link, useNavigate } from "react-router-dom";

import {
  loginThunk,
  fetchProfileThunk,
} from "../store/authSlice";

import type { RootState, AppDispatch } from "../store";
import { handleApiError } from "../utils/toastHelper";
import { resolveLoginRedirect } from "../utils/authRedirect";

type Props = {
  title: string;
  redirectAdmin?: boolean;
};

export default function LoginForm({
  title,
  redirectAdmin = false,
}: Props) {
  const dispatch = useDispatch<AppDispatch>();
  const navigate = useNavigate();

  const loading = useSelector(
    (s: RootState) => s.auth.loading
  );

  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const submit = async (e: React.FormEvent) => {
    e.preventDefault();

    const loginRes = await dispatch(
      loginThunk({ email, password })
    );

    if (loginThunk.rejected.match(loginRes)) {
      handleApiError(loginRes.payload || loginRes.error);
      return;
    }

    const profileRes = await dispatch(
      fetchProfileThunk()
    );

    const redirectTo = resolveLoginRedirect(
      profileRes.payload?.user ?? null,
      redirectAdmin
    );

    navigate(redirectTo, { replace: true });
  };

  return (
    <div className="container mt-5" style={{ maxWidth: 420 }}>
      <h4 className="mb-3 text-center">{title}</h4>

      <form onSubmit={submit}>
        <input
          className="form-control mb-3"
          type="email"
          placeholder="Email"
          value={email}
          required
          onChange={(e) => setEmail(e.target.value)}
        />

        <input
          className="form-control mb-3"
          type="password"
          placeholder="Password"
          value={password}
          required
          onChange={(e) => setPassword(e.target.value)}
        />

        <button
          className="btn btn-primary w-100"
          disabled={loading}
        >
          {loading ? "Logging in..." : "Login"}
        </button>

        <Link to="/forgot-password" className="d-block mt-2">
          Forgot password?
        </Link>
      </form>
    </div>
  );
}



=============================
FILE: textutils-react/src/auth/RegisterForm.tsx
=============================
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { registerService } from "../services/authService";
import { handleApiError } from "../utils/toastHelper";

export default function RegisterForm() {
  const navigate = useNavigate();

  const [form, setForm] = useState({
    name: "",
    email: "",
    password: "",
    password_confirmation: "",
  });

  const submit = async (e: React.FormEvent) => {
    e.preventDefault();

    try {
      await registerService(form);
      navigate("/verify-email", { replace: true });
    } catch (e: any) {
      handleApiError(e);
    }
  };

  return (
    <form onSubmit={submit}>
      <input
        className="form-control mb-2"
        placeholder="Name"
        required
        onChange={(e) =>
          setForm({ ...form, name: e.target.value })
        }
      />

      <input
        className="form-control mb-2"
        type="email"
        placeholder="Email"
        required
        onChange={(e) =>
          setForm({ ...form, email: e.target.value })
        }
      />

      <input
        className="form-control mb-2"
        type="password"
        placeholder="Password"
        required
        onChange={(e) =>
          setForm({ ...form, password: e.target.value })
        }
      />

      <input
        className="form-control mb-3"
        type="password"
        placeholder="Confirm Password"
        required
        onChange={(e) =>
          setForm({
            ...form,
            password_confirmation: e.target.value,
          })
        }
      />

      <button className="btn btn-primary w-100">
        Sign Up
      </button>
    </form>
  );
}



=============================
FILE: textutils-react/src/auth/guards/Guard.tsx
=============================
import { Navigate, Outlet } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";

type Props = {
  admin?: boolean;
  permission?: string;
};

export default function Guard({
  admin = false,
  permission,
}: Props) {
  const {
    isAuth,
    isAdmin,
    can,
    user,
    forcePasswordReset,
  } = useAuth();

  /* ðŸ”’ NOT LOGGED IN */
  if (!isAuth) {
    return (
      <Navigate
        to={admin ? "/admin/login" : "/login"}
        replace
      />
    );
  }

  /* ðŸ”‘ FORCE PASSWORD RESET (ADMIN + USER) */
  if (forcePasswordReset) {
    return (
      <Navigate
        to="/reset-password-required"
        replace
      />
    );
  }

  /* ðŸ“§ EMAIL NOT VERIFIED (USER ONLY) */
  // if (
  //   !admin &&
  //   user &&
  //   !user.email_verified_at
  // ) {
  //   return <Navigate to="/verify-email" replace />;
  // }

  /* ðŸ›¡ ADMIN ACCESS */
  if (admin && !isAdmin) {
    return <Navigate to="/profile" replace />;
  }

  /* ðŸ” PERMISSION CHECK */
  if (permission && !can(permission)) {
    return (
      <Navigate
        to="/admin/unauthorized"
        replace
      />
    );
  }

  return <Outlet />;
}



=============================
FILE: textutils-react/src/auth/hooks/useAuth.ts
=============================
import { useSelector } from "react-redux";
import { RootState } from "../../store";
import { ADMIN_ROLES } from "../../constants/roles";

export function useAuth() {
  const user = useSelector((s: RootState) => s.auth.user);
  const permissions = useSelector((s: RootState) => s.auth.permissions);

  const roles: string[] = user?.roles ?? [];

  const isAuth = Boolean(user);

  const isSuperAdmin = roles.includes("super-admin");

  const isAdmin =
    isSuperAdmin ||
    roles.some((r) => ADMIN_ROLES.includes(r as any));

  const hasRole = (role: string): boolean =>
    isSuperAdmin || roles.includes(role);

  const hasAnyRole = (checkRoles: string[]): boolean =>
    isSuperAdmin || checkRoles.some((r) => roles.includes(r));

  const can = (permission: string): boolean =>
    isSuperAdmin || permissions.includes(permission);

  const canAny = (perms: string[]): boolean =>
    isSuperAdmin || perms.some((p) => permissions.includes(p));

  return {
    user,
    roles,
    permissions,

    isAuth,
    isAdmin,
    isSuperAdmin,

    hasRole,
    hasAnyRole,
    can,
    canAny,
  };
}



=============================
FILE: textutils-react/src/auth/hooks/useLogout.ts
=============================
import { useDispatch } from "react-redux";
import { useNavigate } from "react-router-dom";

import { logoutThunk } from "../../store/authSlice";
import { logoutService } from "../../services/authService";

export function useLogout() {
  const dispatch = useDispatch();
  const navigate = useNavigate();

  return async (redirectTo: string = "/admin/login") => {
    // 1ï¸âƒ£ clear frontend auth
    dispatch(logoutThunk());

    // 2ï¸âƒ£ redirect immediately
    navigate(redirectTo, { replace: true });

    // 3ï¸âƒ£ backend logout (best effort)
    try {
      await logoutService();
    } catch {
      // ignore
    }
  };
}



=============================
FILE: textutils-react/src/auth/hooks/usePermission.ts
=============================
import { useAuth } from "./useAuth";

/**
 * Thin permission wrapper
 * ------------------------------------------------
 * This hook exists ONLY for backward compatibility.
 * Actual permission logic lives in `useAuth`.
 *
 * Recommended new usage:
 *   const { can } = useAuth();
 */
export function usePermission() {
  const { can } = useAuth();

  return can;
}



=============================
FILE: textutils-react/src/auth/layouts/AuthLayout.tsx
=============================
import { Outlet, Navigate } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";

export default function AuthLayout() {
  const { isAuth, isAdmin } = useAuth();

  if (isAuth && isAdmin) {
    return <Navigate to="/admin/dashboard" replace />;
  }

  if (isAuth) {
    return <Navigate to="/profile" replace />;
  }

  return (
    <div className="auth-wrapper d-flex align-items-center justify-content-center min-vh-100">
      <Outlet />
    </div>
  );
}



=============================
FILE: textutils-react/src/components/MenuRenderer.tsx
=============================
import { NavLink, useLocation } from "react-router-dom";
import { useEffect, useState } from "react";
import { SidebarGroup } from "../types/sidebar";

type Props = {
  group: SidebarGroup;
  onAction?: (action: string) => void;
};

export default function MenuRenderer({
  group,
  onAction,
}: Props) {
  const location = useLocation();
  const [open, setOpen] = useState(false);

  const items = group.children ?? [];

  /* ================= AUTO OPEN ACTIVE GROUP ================= */

  useEffect(() => {
    const shouldOpen = items.some(
      (item) =>
        item.path &&
        location.pathname.startsWith(item.path)
    );

    if (shouldOpen) setOpen(true);
  }, [location.pathname, items]);

  if (!items.length) return null;

  /* ================= RENDER ================= */

  return (
    <li className={`nav-item ${open ? "menu-open" : ""}`}>
      <a
        href="#"
        className={`nav-link ${open ? "active" : ""}`}
        onClick={(e) => {
          e.preventDefault();
          setOpen((v) => !v);
        }}
      >
        <i className={`nav-icon ${group.icon}`} />
        <p>
          {group.label}
          <i className="right fas fa-angle-left" />
        </p>
      </a>

      <ul
        className="nav nav-treeview"
        style={{ display: open ? "block" : "none" }}
      >
        {items.map((item) => (
          <li key={item.label} className="nav-item">
            {item.action ? (
              <a
                href="#"
                className="nav-link text-danger"
                onClick={(e) => {
                  e.preventDefault();
                  onAction?.(item.action);
                }}
              >
                <i className="fas fa-sign-out-alt nav-icon" />
                <p>{item.label}</p>
              </a>
            ) : (
              <NavLink
                to={item.path!}
                className="nav-link"
              >
                <i className="far fa-circle nav-icon" />
                <p>{item.label}</p>
              </NavLink>
            )}
          </li>
        ))}
      </ul>
    </li>
  );
}



=============================
FILE: textutils-react/src/components/RolePermissionModal.tsx
=============================
import { useEffect, useState } from "react";
import Modal from "./common/Modal";
import {
  useGetRolePermissionsQuery,
  useAssignRolePermissionsMutation,
} from "../store/api";
import { execute } from "../utils/execute";
import type { Role } from "../types/models";

type Props = {
  role: Role;
  onClose: () => void;
};

export default function RolePermissionModal({
  role,
  onClose,
}: Props) {
  // ðŸ”’ SUPER ADMIN LOCK
  if (role.name === "super-admin") {
    return (
      <Modal title="Assign Permissions" onClose={onClose}>
        <p className="text-danger mb-0">
          Super admin permissions cannot be modified.
        </p>
      </Modal>
    );
  }

  const [selected, setSelected] = useState<string[]>([]);

  const { data, isLoading } =
    useGetRolePermissionsQuery(role.id);

  const [assignRolePermissions, { isLoading: saving }] =
    useAssignRolePermissionsMutation();

  useEffect(() => {
    setSelected(data?.assigned ?? []);
  }, [data?.assigned]);

  const toggle = (permission: string) => {
    setSelected((prev) =>
      prev.includes(permission)
        ? prev.filter((p) => p !== permission)
        : [...prev, permission]
    );
  };

  const save = async () => {
    await execute(
      () =>
        assignRolePermissions({
          id: role.id,
          permissions: selected,
        }).unwrap(),
      "Permissions assigned successfully"
    );
    onClose();
  };

  return (
    <Modal
      title={`Assign Permissions â€“ ${role.name}`}
      onClose={onClose}
      onSave={save}
      saveDisabled={saving}
      saveText={saving ? "Saving..." : "Assign"}
      size="lg"
    >
      {isLoading && <p>Loading permissions...</p>}

      {!isLoading && data?.permissions && (
        <div className="row">
          {data.permissions.map((p: any) => (
            <div key={p.id} className="col-md-4">
              <div className="form-check">
                <input
                  type="checkbox"
                  className="form-check-input"
                  checked={selected.includes(p.name)}
                  onChange={() => toggle(p.name)}
                  disabled={saving}
                />
                <label className="form-check-label">
                  {p.name}
                </label>
              </div>
            </div>
          ))}
        </div>
      )}
    </Modal>
  );
}



=============================
FILE: textutils-react/src/components/common/Button.tsx
=============================
type Props = {
  label?: string;
  onClick?: () => void;
  variant?: "primary" | "secondary" | "success" | "warning" | "danger";
  loading?: boolean;
  disabled?: boolean;
  icon?: string;
  size?: "sm" | "md" | "lg";
  className?: string;
  type?: "button" | "submit" | "reset";
};

export default function Button({
  label,
  onClick,
  variant = "primary",
  loading = false,
  disabled = false,
  icon,
  size = "md",
  className = "",
  type = "button",
}: Props) {
  const sizeClass =
    size === "sm" ? "btn-sm" : size === "lg" ? "btn-lg" : "";

  return (
    <button
      type={type}
      className={`btn btn-${variant} ${sizeClass} ${className}`}
      onClick={onClick}
      disabled={disabled || loading}
    >
      {loading && (
        <span className="spinner-border spinner-border-sm mr-2" />
      )}
      {icon && !loading && <i className={`${icon} mr-1`} />}
      {label}
    </button>
  );
}



=============================
FILE: textutils-react/src/components/common/Can.tsx
=============================
import { useAuth } from "../../auth/hooks/useAuth";

export default function Can({
  permission,
  children,
}: {
  permission: string;
  children: JSX.Element;
}) {
  const { can } = useAuth();
  return can(permission) ? children : null;
}



=============================
FILE: textutils-react/src/components/common/Card.tsx
=============================
type Props = {
  title: string;
  children: React.ReactNode;
};

export function Card({ title, children }: Props) {
  return (
    <div className="card mb-4">
      <div className="card-header fw-bold">
        {title}
      </div>
      <div className="card-body">
        {children}
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/components/common/ConfirmDeleteModal.tsx
=============================
import { useState } from "react";
import Modal from "./Modal";

type Props = {
  message: string;                 // ðŸ”¥ one-line message only
  onConfirm: () => Promise<void>;  // async safe
  onClose: () => void;
  confirmLabel?: string;
};

export default function ConfirmDeleteModal({
  message,
  onConfirm,
  onClose,
  confirmLabel = "Delete", // default
}: Props) {
  const [loading, setLoading] = useState(false);

  const handleConfirm = async () => {
    try {
      setLoading(true);
      await onConfirm();
      onClose();
    } finally {
      setLoading(false);
    }
  };

  return (
    <Modal
      title="Confirm Action"
      onClose={onClose}
      onSave={handleConfirm}
      saveDisabled={loading}
      saveText="Delete"
      button_name={loading ? "Deleting..." : "Yes, Delete"}
      saveVariant="danger" 
      dialogClassName="modal-sm"
      disableClose={loading}
    >
      {/* ðŸ”¥ RULE: ONE SENTENCE, CLEAR CONSEQUENCE */}
      <p className="text-danger mb-0">
        {message}
      </p>
    </Modal>
  );
}



=============================
FILE: textutils-react/src/components/common/DataTable.tsx
=============================
import React from "react";
import TableSkeleton from "./TableSkeleton";
import TableEmptyRow from "./TableEmptyRow";

type Props = {
  isLoading: boolean;
  columns: React.ReactNode;
  children: React.ReactNode;
  colSpan: number;

  /** explicit & predictable */
  hasData: boolean;
  emptyMessage?: string;
};

export default function DataTable({
  isLoading,
  columns,
  children,
  colSpan,
  hasData,
  emptyMessage,
}: Props) {
  return (
    <table className="table table-hover table-bordered text-nowrap">
      <thead className="thead-dark">{columns}</thead>

      {isLoading ? (
        <TableSkeleton rows={5} cols={colSpan} />
      ) : (
        <tbody>
          {hasData ? (
            children
          ) : (
            <TableEmptyRow
              colSpan={colSpan}
              message={emptyMessage}
            />
          )}
        </tbody>
      )}
    </table>
  );
}



=============================
FILE: textutils-react/src/components/common/ErrorBoundary.tsx
=============================
import React from "react";

type Props = {
  children: React.ReactNode;
};

type State = {
  hasError: boolean;
  error?: Error;
};

export default class ErrorBoundary extends React.Component<Props, State> {
  state: State = {
    hasError: false,
  };

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, info: React.ErrorInfo) {
    // ðŸ”¥ future: send to Sentry / LogRocket
    console.error("App crashed:", error, info);
  }

  reload = () => {
    window.location.reload();
  };

  render() {
    if (this.state.hasError) {
      return (
        <div className="container mt-5 text-center">
          <h2 className="text-danger mb-3">
            Something went wrong ðŸ˜¢
          </h2>

          <p className="text-muted">
            The application crashed unexpectedly.
            <br />
            Please reload the page.
          </p>

          <button
            className="btn btn-primary mt-3"
            onClick={this.reload}
          >
            Reload App
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}



=============================
FILE: textutils-react/src/components/common/Modal.tsx
=============================
import { useEffect } from "react";
import Button from "./Button";
import { ICONS } from "../../constants/icons";

type Props = {
  title: string;
  children: React.ReactNode;

  onClose: () => void;

  /* primary action */
  onSave?: () => void;
  saveText?: string;
  saveVariant?: "primary" | "success" | "danger";

  /* secondary */
  cancelText?: string;

  /* state */
  loading?: boolean;
  disableClose?: boolean;

  /* layout */
  size?: "sm" | "md" | "lg";

  /* advanced */
  footer?: React.ReactNode; // ðŸ”¥ custom footer override
};

export default function Modal({
  title,
  children,
  onClose,

  onSave,
  saveText = "Save",
  saveVariant = "primary",
  cancelText = "Cancel",

  loading = false,
  disableClose = false,

  size = "md",
  footer,
}: Props) {
  /* ================= BODY LOCK ================= */
  useEffect(() => {
    document.body.classList.add("modal-open");

    const onEsc = (e: KeyboardEvent) => {
      if (e.key === "Escape" && !disableClose) {
        onClose();
      }
    };

    window.addEventListener("keydown", onEsc);

    return () => {
      document.body.classList.remove("modal-open");
      window.removeEventListener("keydown", onEsc);
    };
  }, [disableClose, onClose]);

  const sizeClass =
    size === "sm" ? "modal-sm" : size === "lg" ? "modal-lg" : "";

  /* ================= RENDER ================= */
  return (
    <>
      {/* BACKDROP */}
      <div className="modal-backdrop fade show" />

      {/* MODAL */}
      <div
        className="modal fade show d-block"
        role="dialog"
        aria-modal="true"
      >
        <div
          className={`modal-dialog modal-dialog-centered ${sizeClass}`}
          onClick={(e) => e.stopPropagation()}
        >
          <div className="modal-content">
            {/* HEADER */}
            <div className="modal-header">
              <h5 className="modal-title">{title}</h5>

              {!disableClose && (
                <button
                  type="button"
                  className="close"
                  onClick={onClose}
                  aria-label="Close"
                >
                  Ã—
                </button>
              )}
            </div>

            {/* BODY */}
            <div className="modal-body">{children}</div>

            {/* FOOTER */}
            <div className="modal-footer justify-content-between">
              {footer ? (
                footer
              ) : (
                <>
                  <Button
                    label={cancelText}
                    variant="secondary"
                    onClick={onClose}
                    disabled={disableClose || loading}
                  />

                  {onSave && (
                    <Button
                      label={saveText}
                      icon={ICONS.SAVE}
                      variant={saveVariant}
                      loading={loading}
                      onClick={onSave}
                    />
                  )}
                </>
              )}
            </div>
          </div>
        </div>
      </div>
    </>
  );
}



=============================
FILE: textutils-react/src/components/common/ModalHost.tsx
=============================
import { useAppModal } from "../../context/AppModalContext";
import ConfirmDeleteModal from "./ConfirmDeleteModal";

export default function ModalHost() {
  const { modalType, modalData, closeModal } =
    useAppModal();

  if (modalType !== "confirm-delete") return null;

  return (
    <ConfirmDeleteModal
      message={modalData!.message}
      onConfirm={modalData!.onConfirm}
      onClose={closeModal}
      confirmLabel={modalData!.confirmLabel}
    />
  );
}



=============================
FILE: textutils-react/src/components/common/PageHeader.tsx
=============================
type Props = {
  title: string;
  action?: React.ReactNode;
};

export default function PageHeader({ title, action }: Props) {
  return (
    <div className="card mb-3">
      <div className="card-header d-flex justify-content-between align-items-center">
        <h3 className="card-title mb-0">{title}</h3>
        {action}
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/components/common/Pagination.tsx
=============================
type Meta = {
  current_page: number;
  last_page: number;
  total: number;
  per_page: number;
};

type Props = {
  meta: Meta;
  onPageChange: (page: number) => void;
  onPerPageChange?: (size: number) => void;
  pageSizeOptions?: number[];
};

export default function Pagination({
  meta,
  onPageChange,
  onPerPageChange,
  pageSizeOptions = [10, 25, 50],
}: Props) {
  const { current_page, last_page, total, per_page } = meta;

  if (last_page <= 1) return null;

  /* ================= PAGE NUMBERS ================= */
  const getPages = () => {
    const pages: number[] = [];
    const start = Math.max(1, current_page - 2);
    const end = Math.min(last_page, current_page + 2);

    for (let i = start; i <= end; i++) {
      pages.push(i);
    }
    return pages;
  };

  return (
    <div className="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2">
      {/* LEFT INFO */}
      <div className="text-muted small">
        Page {current_page} of {last_page} â€¢ Total {total}
      </div>

      {/* RIGHT CONTROLS */}
      <div className="d-flex align-items-center gap-2">
        {/* PAGE SIZE */}
        {onPerPageChange && (
          <select
            className="form-select form-select-sm"
            style={{ width: 80 }}
            value={per_page}
            onChange={(e) =>
              onPerPageChange(Number(e.target.value))
            }
          >
            {pageSizeOptions.map((size) => (
              <option key={size} value={size}>
                {size}
              </option>
            ))}
          </select>
        )}

        {/* PREV */}
        <button
          className="btn btn-outline-secondary btn-sm"
          disabled={current_page === 1}
          onClick={() => onPageChange(current_page - 1)}
        >
          Prev
        </button>

        {/* PAGE NUMBERS */}
        {getPages().map((page) => (
          <button
            key={page}
            className={`btn btn-sm ${
              page === current_page
                ? "btn-primary"
                : "btn-outline-secondary"
            }`}
            onClick={() => onPageChange(page)}
          >
            {page}
          </button>
        ))}

        {/* NEXT */}
        <button
          className="btn btn-outline-secondary btn-sm"
          disabled={current_page === last_page}
          onClick={() => onPageChange(current_page + 1)}
        >
          Next
        </button>
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/components/common/RowActions.tsx
=============================
import Button from "./Button";

export type RowAction = {
  key: string; // ðŸ”’ REQUIRED & UNIQUE
  label: string;
  onClick: () => void;
  variant?: "primary" | "secondary" | "warning" | "danger" | "success";
  show?: boolean;
  disabled?: boolean;
  icon?: string;
};

type Props = {
  actions: RowAction[];
};

export default function RowActions({ actions }: Props) {
  const visibleActions = actions.filter(
    (a) => a.show !== false
  );

  if (visibleActions.length === 0) return null;

  return (
    <div className="btn-group btn-group-sm">
      {visibleActions.map((action) => (
        <Button
          key={action.key}
          label={action.label}
          variant={action.variant}
          onClick={action.onClick}
          disabled={action.disabled}
          icon={action.icon}
          size="sm"
        />
      ))}
    </div>
  );
}



=============================
FILE: textutils-react/src/components/common/StatusToggle.tsx
=============================
type Props = {
  checked: boolean;
  onToggle: () => void;
  disabled?: boolean;
};

export default function StatusToggle({
  checked,
  onToggle,
  disabled,
}: Props) {
  return (
    <button
      type="button"
      className={`btn btn-sm ${
        checked ? "btn-success" : "btn-secondary"
      }`}
      onClick={onToggle}
      disabled={disabled}
    >
      {checked ? "Active" : "Inactive"}
    </button>
  );
}



=============================
FILE: textutils-react/src/components/common/TableEmptyRow.tsx
=============================
type Props = {
  colSpan: number;
  message?: string;
};

export default function TableEmptyRow({
  colSpan,
  message = "No records found",
}: Props) {
  return (
    <tr>
      <td colSpan={colSpan} className="text-center text-muted py-4">
        {message}
      </td>
    </tr>
  );
}



=============================
FILE: textutils-react/src/components/common/TableSkeleton.tsx
=============================
type Props = {
  rows?: number;
  cols?: number;
};

export default function TableSkeleton({
  rows = 5,
  cols = 4,
}: Props) {
  return (
    <tbody>
      {Array.from({ length: rows }).map((_, i) => (
        <tr key={i}>
          <td colSpan={cols}>
            <div className="placeholder-glow">
              <span
                className="placeholder col-12 bg-secondary"
                style={{ height: 20 }}
              />
            </div>
          </td>
        </tr>
      ))}
    </tbody>
  );
}



=============================
FILE: textutils-react/src/components/permissions/PermissionGroupAccordion.tsx
=============================
type PermissionItem = {
  id: number;
  name: string;
};

type Props = {
  permissions: Record<string, PermissionItem[]>;
  selected: string[];
  inherited?: string[];
  onChange: (values: string[]) => void;
};

export default function PermissionGroupAccordion({
  permissions,
  selected,
  inherited = [],
  onChange,
}: Props) {
  const toggle = (name: string) => {
    if (inherited.includes(name)) return;

    onChange(
      selected.includes(name)
        ? selected.filter((p) => p !== name)
        : [...selected, name]
    );
  };

  return (
    <div>
      {Object.entries(permissions).map(([group, items]) => (
        <div key={group} className="mb-3">
          <h6 className="fw-bold">{group}</h6>

          {items.map((p) => {
            const isInherited = inherited.includes(p.name);

            return (
              <label key={p.id} className="d-block">
                <input
                  type="checkbox"
                  className="me-2"
                  checked={selected.includes(p.name) || isInherited}
                  disabled={isInherited}
                  onChange={() => toggle(p.name)}
                />
                {p.name}
                {isInherited && (
                  <span className="text-muted ms-2">(inherited)</span>
                )}
              </label>
            );
          })}
        </div>
      ))}
    </div>
  );
}



=============================
FILE: textutils-react/src/config/appRoutes.tsx
=============================
// src/config/appRoutes.tsx

import { lazy } from "react";
import Profile from "../pages/user/Profile";
import UserRoles from "../pages/user/UserRoles";
import { PERMISSIONS } from "../constants/permissions";

// ðŸ”¹ Lazy loaded admin pages
const Dashboard = lazy(() => import("../pages/admin/Dashboard"));
const Users = lazy(() => import("../pages/admin/Users"));
const Roles = lazy(() => import("../pages/admin/Roles"));
const PermissionsPage = lazy(
  () => import("../pages/admin/PermissionsPage")
);

export type AppRoute = {
  path: string;
  element: JSX.Element;
  permission?: string;
  admin?: boolean;
};

/* ================= ADMIN ROUTES ================= */
export const adminAppRoutes: AppRoute[] = [
  {
    path: "dashboard",
    element: <Dashboard />,
    admin: true,
  },
  {
    path: "profile",
    element: <Profile />,
    admin: true,
  },
  {
    path: "users",
    element: <Users />,
    admin: true,
    permission: PERMISSIONS.USER.VIEW,
  },
  {
    path: "roles",
    element: <Roles />,
    admin: true,
    permission: PERMISSIONS.ROLE.MANAGE,
  },
  {
    path: "permissions",
    element: <PermissionsPage />,
    admin: true,
    permission: PERMISSIONS.PERMISSION.MANAGE,
  },
];

/* ================= USER ROUTES ================= */
export const userAppRoutes: AppRoute[] = [
  {
    path: "profile",
    element: <Profile />,
  },
  {
    path: "roles",
    element: <UserRoles />,
  },
];



=============================
FILE: textutils-react/src/constants/icons.ts
=============================
export const ICONS = {
  ADD: "fas fa-plus",
  EDIT: "fas fa-edit",
  DELETE: "fas fa-trash",
  SAVE: "fas fa-save",
  ROLE: "fas fa-user-shield",
  PERMISSION: "fas fa-key",
  USER: "fas fa-users",
  RESTORE: "fas fa-undo",
};



=============================
FILE: textutils-react/src/constants/permissions.ts
=============================
export const PERMISSIONS = {
  USER: {
    VIEW: "user-view",
    CREATE: "user-create",
    DELETE: "user-delete",
    ASSIGN_ROLE: "user-assign-role",
    ASSIGN_PERMISSION: "user-assign-permission",
    
  },
  ROLE: {
    MANAGE: "role-manage",
  },
  PERMISSION: {
    MANAGE: "permission-manage",
  },
} as const;
//user-permission
export type Permission =
  | (typeof PERMISSIONS)[keyof typeof PERMISSIONS][keyof (typeof PERMISSIONS)[any]];



=============================
FILE: textutils-react/src/constants/roles.ts
=============================
export const ADMIN_ROLES = [
  "super-admin",
  "admin",
  // future: "manager", "staff"
] as const;



=============================
FILE: textutils-react/src/constants/routeGroups.ts
=============================
// src/constants/routeGroups.ts

export const ROUTE_GROUPS = {
  USER_MANAGEMENT: "USER_MANAGEMENT",
  SETTINGS: "SETTINGS",
} as const;

export type RouteGroup =
  (typeof ROUTE_GROUPS)[keyof typeof ROUTE_GROUPS];



=============================
FILE: textutils-react/src/context/AppModalContext.tsx
=============================
// src/context/AppModalContext.tsx

import {
  createContext,
  useContext,
  useState,
  ReactNode,
} from "react";

import type { ModalMap } from "../types/modal";

/* =====================================================
   TYPES
===================================================== */

type ModalContextType = {
  modalType: keyof ModalMap | null;
  modalData: ModalMap[keyof ModalMap] | null;

  openModal: <T extends keyof ModalMap>(
    type: T,
    data: ModalMap[T]
  ) => void;

  closeModal: () => void;
};

/* =====================================================
   CONTEXT
===================================================== */

const AppModalContext =
  createContext<ModalContextType | null>(null);

/* =====================================================
   PROVIDER
===================================================== */

export function AppModalProvider({
  children,
}: {
  children: ReactNode;
}) {
  const [modalType, setModalType] =
    useState<keyof ModalMap | null>(null);

  const [modalData, setModalData] =
    useState<ModalMap[keyof ModalMap] | null>(null);

  const openModal = <T extends keyof ModalMap>(
    type: T,
    data: ModalMap[T]
  ) => {
    setModalType(type);
    setModalData(data);
  };

  const closeModal = () => {
    setModalType(null);
    setModalData(null);
  };

  return (
    <AppModalContext.Provider
      value={{
        modalType,
        modalData,
        openModal,
        closeModal,
      }}
    >
      {children}
    </AppModalContext.Provider>
  );
}

/* =====================================================
   HOOK
===================================================== */

export function useAppModal() {
  const ctx = useContext(AppModalContext);

  if (!ctx) {
    throw new Error(
      "useAppModal must be used inside AppModalProvider"
    );
  }

  return ctx;
}



=============================
FILE: textutils-react/src/features/audit/AuditLogsPage.tsx
=============================
import { useState } from "react";
import { useGetAuditLogsQuery } from "@/store/api.audit";
import AuditLogsTable from "./AuditLogsTable";
import AuditLogsFilters from "./AuditLogsFilters";
import Can from "@/components/common/Can";

export default function AuditLogsPage() {
  const [page, setPage] = useState(1);
  const [action, setAction] = useState<string | undefined>();

  const { data, isLoading } = useGetAuditLogsQuery({
    page,
    action,
  });

  return (
    <Can permission="audit-view">
      <section className="content pt-3">
        <div className="container-fluid">
          <h3 className="mb-3">Audit Logs</h3>

          <AuditLogsFilters
            action={action}
            onActionChange={(value) => {
              setPage(1);
              setAction(value);
            }}
          />

          <AuditLogsTable
            logs={data?.data ?? []}
            loading={isLoading}
          />

          {data?.meta && (
            <div className="d-flex justify-content-end mt-3 gap-2">
              <button
                className="btn btn-outline-secondary btn-sm"
                disabled={page <= 1}
                onClick={() => setPage((p) => p - 1)}
              >
                Prev
              </button>

              <button
                className="btn btn-outline-secondary btn-sm"
                disabled={page >= data.meta.last_page}
                onClick={() => setPage((p) => p + 1)}
              >
                Next
              </button>
            </div>
          )}
        </div>
      </section>
    </Can>
  );
}



=============================
FILE: textutils-react/src/guards/AdminGuard.tsx
=============================
import { Navigate, Outlet } from "react-router-dom";
import { useAuth } from "../auth/hooks/useAuth";

export default function AdminGuard() {
  const { isAuth, isAdmin } = useAuth();

  if (!isAuth) {
    return <Navigate to="/admin/login" replace />;
  }

  if (!isAdmin) {
    return <Navigate to="/admin/unauthorized" replace />;
  }

  return <Outlet />;
}



=============================
FILE: textutils-react/src/guards/AuthGuard.tsx
=============================
import { Navigate, Outlet } from "react-router-dom";
import { useAuth } from "../auth/hooks/useAuth";

export default function AuthGuard() {
  const { isAuth } = useAuth();

  if (!isAuth) {
    return <Navigate to="/login" replace />;
  }

  return <Outlet />;
}



=============================
FILE: textutils-react/src/guards/PermissionGuard.tsx
=============================
import { Navigate, Outlet } from "react-router-dom";
import { useAuth } from "../auth/hooks/useAuth";

type Props = {
  permission: string;
};

export default function PermissionGuard({ permission }: Props) {
  const { isAuth, can } = useAuth();

  if (!isAuth) {
    return <Navigate to="/admin/login" replace />;
  }

  if (!can(permission)) {
    return <Navigate to="/admin/unauthorized" replace />;
  }

  return <Outlet />;
}



=============================
FILE: textutils-react/src/hooks/useBackendForm.ts
=============================
// src/hooks/useBackendForm.ts

import { useState } from "react";

/**
 * Backend validation errors
 * Format:
 * {
 *   field: ["error message"]
 * }
 */
type Errors<T> = Partial<Record<keyof T, string[]>>;

export function useBackendForm<T extends Record<string, any>>(
  initialValues: T
) {
  const [values, setValues] = useState<T>(initialValues);
  const [errors, setErrors] = useState<Errors<T>>({});
  const [loading, setLoading] = useState(false);

  /* ================= FIELD UPDATE ================= */

  const setField = <K extends keyof T>(
    key: K,
    value: T[K]
  ) => {
    setValues((prev) => ({ ...prev, [key]: value }));
    setErrors((prev) => ({ ...prev, [key]: undefined }));
  };

  /* ================= BACKEND ERROR HANDLER ================= */

  const handleError = (error: any) => {
    if (error?.response?.status === 422) {
      setErrors(error.response.data?.errors || {});
    }
  };

  /* ================= RESET ================= */

  const reset = () => {
    setValues(initialValues);
    setErrors({});
  };

  return {
    values,
    errors,
    loading,

    // setters
    setField,
    setLoading,

    // helpers
    handleError,
    reset,
  };
}



=============================
FILE: textutils-react/src/hooks/useConfirmAction.ts
=============================
import { useAppModal } from "../context/AppModalContext";

type ConfirmOptions = {
  message: string;
  onConfirm: () => Promise<void>;
  confirmLabel?: string;
};

export function useConfirmAction() {
  const { openModal } = useAppModal();

  return ({ message, onConfirm, confirmLabel }: ConfirmOptions) => {
    openModal("confirm-delete", {
      message,
      onConfirm,
      confirmLabel,
    });
  };
}



=============================
FILE: textutils-react/src/hooks/useConfirmDelete.ts
=============================
import { useConfirmAction } from "./useConfirmAction";

/**
 * @deprecated
 * Use `useConfirmAction` instead.
 *
 * Kept for backward compatibility.
 */
export function useConfirmDelete() {
  const confirm = useConfirmAction();

  return (
    message: string,
    onConfirm: () => Promise<void>,
    confirmLabel?: string
  ) => {
    confirm({
      message,
      onConfirm,
      confirmLabel,
    });
  };
}



=============================
FILE: textutils-react/src/hooks/usePagination.ts
=============================
// src/hooks/usePagination.ts

import { useState } from "react";

type Options = {
  initialPage?: number;
  initialSearch?: string;
};

export function usePagination(options: Options = {}) {
  const [page, setPage] = useState(
    options.initialPage ?? 1
  );
  const [search, setSearch] = useState(
    options.initialSearch ?? ""
  );

  /* ================= SEARCH ================= */
  const onSearchChange = (value: string) => {
    setSearch(value);
    setPage(1); // ðŸ”¥ reset page on search
  };

  return {
    page,
    setPage,

    search,
    setSearch: onSearchChange,
  };
}



=============================
FILE: textutils-react/src/main.tsx
=============================
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import { Provider } from "react-redux";

import App from "./App";
import { store } from "./store";
import { setStore } from "./store/storeAccessor";
import { AppModalProvider } from "./context/AppModalContext";
import ErrorBoundary from "./components/common/ErrorBoundary";
import { listenAuthEvents } from "./utils/authEvents";
import { logoutThunk } from "./store/authSlice";

import "bootstrap/dist/css/bootstrap.min.css";
import "@fortawesome/fontawesome-free/css/all.min.css";
//import "admin-lte/dist/css/adminlte.min.css";

import "bootstrap/dist/js/bootstrap.bundle.min.js";
//import "admin-lte/dist/js/adminlte.min.js";

import { ToastContainer } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";

setStore(store);

/* ===== MULTI TAB LOGOUT ===== */
listenAuthEvents(() => {
  store.dispatch(logoutThunk());
  window.location.replace("/login");
});

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <ErrorBoundary>
      <Provider store={store}>
        <BrowserRouter>
          <AppModalProvider>
            <App />
            <ToastContainer
              position="top-right"
              autoClose={3000}
            />
          </AppModalProvider>
        </BrowserRouter>
      </Provider>
    </ErrorBoundary>
  </React.StrictMode>
);



=============================
FILE: textutils-react/src/pages/admin/AuditLogs/AuditLogsFilters.tsx
=============================
interface Props {
  action?: string;
  onActionChange: (value?: string) => void;
}

export default function AuditLogsFilters({
  action,
  onActionChange,
}: Props) {
  return (
    <div className="card mb-3">
      <div className="card-body d-flex gap-3">
        <select
          className="form-select w-auto"
          value={action ?? ""}
          onChange={e =>
            onActionChange(
              e.target.value || undefined
            )
          }
        >
          <option value="">All Actions</option>
          <option value="login">Login</option>
          <option value="logout">Logout</option>
          <option value="user-roles-updated">User Roles</option>
          <option value="user-permissions-updated">User Permissions</option>
          <option value="role-permissions-updated">Role Permissions</option>
        </select>
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/admin/AuditLogs/AuditLogsPage.tsx
=============================
import { useState } from "react";
import { useGetAuditLogsQuery } from "@/store/api.audit";
import AuditLogsTable from "./components/AuditLogsTable";
import AuditLogsFilters from "./components/AuditLogsFilters";
import Can from "@/components/common/Can";

export default function AuditLogsPage() {
  const [page, setPage] = useState(1);
  const [action, setAction] = useState<string | undefined>();

  const { data, isLoading } = useGetAuditLogsQuery({
    page,
    action,
  });

  return (
    <Can permission="audit-view">
      <section className="content pt-3">
        <div className="container-fluid">
          <h3 className="mb-3">Audit Logs</h3>

          <AuditLogsFilters
            action={action}
            onActionChange={(value) => {
              setPage(1);
              setAction(value);
            }}
          />

          <AuditLogsTable
            logs={data?.data ?? []}
            loading={isLoading}
          />

          {data?.meta && (
            <div className="d-flex justify-content-end mt-3 gap-2">
              <button
                className="btn btn-outline-secondary btn-sm"
                disabled={page <= 1}
                onClick={() => setPage((p) => p - 1)}
              >
                Prev
              </button>

              <button
                className="btn btn-outline-secondary btn-sm"
                disabled={page >= data.meta.last_page}
                onClick={() => setPage((p) => p + 1)}
              >
                Next
              </button>
            </div>
          )}
        </div>
      </section>
    </Can>
  );
}



=============================
FILE: textutils-react/src/pages/admin/AuditLogs/AuditLogsTable.tsx
=============================
import { AuditLog } from "@/types/audit";

interface Props {
  logs: AuditLog[];
  loading?: boolean;
}

export default function AuditLogsTable({
  logs,
  loading,
}: Props) {
  if (loading) {
    return <div>Loading audit logs...</div>;
  }

  if (!logs.length) {
    return <div className="text-muted">No audit logs found.</div>;
  }

  return (
    <div className="card">
      <div className="card-body p-0">
        <table className="table table-striped mb-0">
          <thead>
            <tr>
              <th>#</th>
              <th>User</th>
              <th>Action</th>
              <th>Subject</th>
              <th>IP</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {logs.map(log => (
              <tr key={log.id}>
                <td>{log.id}</td>

                <td>
                  {log.user
                    ? `${log.user.name} (${log.user.email})`
                    : "System"}
                </td>

                <td>
                  <span className="badge bg-info">
                    {log.action}
                  </span>
                </td>

                <td>
                  {log.subject_type
                    ? `${log.subject_type} #${log.subject_id}`
                    : "-"}
                </td>

                <td>{log.ip_address ?? "-"}</td>

                <td>
                  {new Date(log.created_at).toLocaleString()}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/admin/AuditLogs/components/AuditLogsFilters.tsx
=============================
type Props = {
  action?: string;
  onActionChange: (value?: string) => void;
};

export default function AuditLogsFilters({
  action,
  onActionChange,
}: Props) {
  return (
    <div className="mb-3">
      <select
        className="form-select"
        value={action ?? ""}
        onChange={(e) =>
          onActionChange(e.target.value || undefined)
        }
      >
        <option value="">All Actions</option>
        <option value="login">Login</option>
        <option value="logout">Logout</option>
        <option value="role_assigned">Role Assigned</option>
        <option value="permission_changed">Permission Changed</option>
      </select>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/admin/AuditLogs/components/AuditLogsTable.tsx
=============================
import DataTable from "@/components/common/DataTable";
import type { AuditLog } from "@/types/audit";

type Props = {
  logs: AuditLog[];
  loading: boolean;
};

export default function AuditLogsTable({ logs, loading }: Props) {
  return (
    <DataTable
      isLoading={loading}
      hasData={logs.length > 0}
      colSpan={4}
      columns={
        <tr>
          <th>User</th>
          <th>Action</th>
          <th>IP</th>
          <th>Date</th>
        </tr>
      }
    >
      {logs.map((log) => (
        <tr key={log.id}>
          <td>{log.user_name}</td>
          <td>{log.action}</td>
          <td>{log.ip_address}</td>
          <td>{log.created_at}</td>
        </tr>
      ))}
    </DataTable>
  );
}



=============================
FILE: textutils-react/src/pages/admin/Roles/RolePermissionModal.tsx
=============================
import { useEffect, useState } from "react";
import { useAssignRolePermissionsMutation, useGetRolePermissionsQuery } from "@/store/api";
import PermissionGroupAccordion from "@/components/permissions/PermissionGroupAccordion";
import Button from "@/components/common/Button";
import Card from "@/ui/Card";
import CardHeader from "@/ui/CardHeader";
import CardBody from "@/ui/CardBody";

type Props = {
  roleId: number;
  onClose: () => void;
};

export default function RolePermissionModal({ roleId, onClose }: Props) {
  const { data, isLoading } = useGetRolePermissionsQuery(roleId);
  const [assignPermissions] = useAssignRolePermissionsMutation();

  const [selectedPermissions, setSelectedPermissions] = useState<string[]>([]);

  useEffect(() => {
    if (data?.assigned) {
      setSelectedPermissions(data.assigned);
    }
  }, [data]);

  const handleSave = async () => {
    await assignPermissions({
      id: roleId,
      permissions: selectedPermissions,
    }).unwrap();

    onClose();
  };

  if (isLoading || !data) return null;

  return (
    <Card>
      <CardHeader title="Manage Role Permissions" />
      <CardBody>
        <PermissionGroupAccordion
        permissions={data.permissions}
        selected={selectedPermissions}
        inherited={data.inherited}
        onChange={setSelectedPermissions}
        />


        <div className="text-end mt-3">
          <Button label="Save" onClick={handleSave} />
          <Button
            label="Cancel"
            variant="secondary"
            className="ms-2"
            onClick={onClose}
          />
        </div>
      </CardBody>
    </Card>
  );
}



=============================
FILE: textutils-react/src/pages/admin/Users/UserPermissionModal.tsx
=============================
import { useEffect, useState } from "react";
import {
  useAssignUserPermissionsMutation,
  useGetUserPermissionsQuery,
} from "@/store/api";
import PermissionGroupAccordion from "@/components/permissions/PermissionGroupAccordion";
import Button from "@/components/common/Button";
import Card from "@/ui/Card";
import CardHeader from "@/ui/CardHeader";
import CardBody from "@/ui/CardBody";

type Props = {
  userId: number;
  onClose: () => void;
};

export default function UserPermissionModal({ userId, onClose }: Props) {
  const { data, isLoading } = useGetUserPermissionsQuery(userId);
  const [assignPermissions] = useAssignUserPermissionsMutation();

  const [selectedPermissions, setSelectedPermissions] = useState<string[]>([]);

  useEffect(() => {
    if (data?.assigned) {
      setSelectedPermissions(data.assigned);
    }
  }, [data]);

  const handleSave = async () => {
    await assignPermissions({
      id: userId,
      permissions: selectedPermissions,
    }).unwrap();

    onClose();
  };

  if (isLoading || !data) return null;

  return (
    <Card>
      <CardHeader title="Manage User Permissions" />
      <CardBody>
        <PermissionGroupAccordion
          permissions={data.permissions}
          selected={selectedPermissions}
          onChange={setSelectedPermissions}
        />

        <div className="text-end mt-3">
          <Button label="Save" onClick={handleSave} />
          <Button
            label="Cancel"
            variant="secondary"
            className="ms-2"
            onClick={onClose}
          />
        </div>
      </CardBody>
    </Card>
  );
}



=============================
FILE: textutils-react/src/pages/auth/ForgotPassword.tsx
=============================
import { useBackendForm } from "../../hooks/useBackendForm";
import api from "../../api/axios";
import { execute } from "../../utils/execute";

type FormValues = {
  email: string;
};

export default function ForgotPassword() {
  const {
    values,
    errors,
    loading,
    setLoading,
    setField,
    handleError,
    reset,
  } = useBackendForm<FormValues>({
    email: "",
  });

  /* ================= SUBMIT ================= */
  const submit = async (e: React.FormEvent) => {
    e.preventDefault();

    await execute(
      async () => {
        setLoading(true);

        const res = await api.post("/forgot-password", {
          email: values.email,
        });

        reset();
        return res;
      },
      "Password reset link sent to your email"
    ).catch(handleError)
     .finally(() => setLoading(false));
  };

  return (
    <div className="container mt-5" style={{ maxWidth: 420 }}>
      <h4 className="mb-3">Forgot Password</h4>

      <form onSubmit={submit}>
        {/* EMAIL */}
        <input
          type="email"
          className={`form-control mb-2 ${
            errors.email ? "is-invalid" : ""
          }`}
          placeholder="Enter your email"
          value={values.email}
          onChange={(e) => setField("email", e.target.value)}
          disabled={loading}
          required
        />

        {errors.email && (
          <div className="invalid-feedback">
            {errors.email[0]}
          </div>
        )}

        <button className="btn btn-primary w-100" disabled={loading}>
          {loading ? "Sending..." : "Send Reset Link"}
        </button>
      </form>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/auth/Login.tsx
=============================
import { Navigate, useNavigate } from "react-router-dom";
import LoginForm from "../../auth/LoginForm";
import { useAuth } from "../../auth/hooks/useAuth";
import { resolveLoginRedirect } from "../../utils/resolveLoginRedirect";

type Props = {
  admin?: boolean;
};

export default function Login({ admin = false }: Props) {
  const { isAuth, user } = useAuth();
  const navigate = useNavigate();

  if (isAuth) {
    return <Navigate to={resolveLoginRedirect(user)} replace />;
  }

  return (
    <LoginForm
      title={admin ? "Admin Login" : "User Login"}
      redirectAdmin={admin}
      onSuccess={(user) => {
        navigate(resolveLoginRedirect(user), { replace: true });
      }}
    />
  );
}



=============================
FILE: textutils-react/src/pages/auth/Register.tsx
=============================
import RegisterForm from "../../auth/RegisterForm";

export default function Register() {
  return (
    <div className="container mt-5" style={{ maxWidth: 420 }}>
      <h4 className="mb-3 text-center">
        Create Account
      </h4>

      <RegisterForm />
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/auth/ResendVerification.tsx
=============================
import api from "../../api/axios";

export default function ResendVerification() {
  const resend = async () => {
    await api.post("/email/resend");
    alert("Verification email sent");
  };

  return (
    <div className="container mt-5 text-center">
      <h4>Email not verified</h4>
      <button onClick={resend} className="btn btn-primary">
        Resend verification email
      </button>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/auth/ResetPassword.tsx
=============================
import { useSearchParams, useNavigate } from "react-router-dom";
import { useState } from "react";
import api from "../../api/axios";
import {
  handleApiError,
  handleApiSuccess,
} from "../../utils/toastHelper";

export default function ResetPassword() {
  const [params] = useSearchParams();
  const navigate = useNavigate();

  const token = params.get("token");
  const email = params.get("email");

  const [password, setPassword] = useState("");
  const [confirm, setConfirm] = useState("");
  const [loading, setLoading] = useState(false);

  const submit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (password !== confirm) {
      return alert("Passwords do not match");
    }

    try {
      setLoading(true);

      const res = await api.post("/reset-password", {
        email,
        token,
        password,
        password_confirmation: confirm,
      });

      handleApiSuccess(res);
      navigate("/login", { replace: true });
    } catch (e) {
      // âœ… Backend DomainException message shown here
      handleApiError(e);
    } finally {
      setLoading(false);
    }
  };

  if (!token || !email) {
    return (
      <p className="text-danger">
        Invalid reset link
      </p>
    );
  }

  return (
    <div
      className="container mt-5"
      style={{ maxWidth: 420 }}
    >
      <h4>Reset Password</h4>

      <form onSubmit={submit}>
        {/* New Password */}
        <input
          type="password"
          className="form-control mb-1"
          placeholder="New password"
          value={password}
          onChange={(e) =>
            setPassword(e.target.value)
          }
          required
        />

        {/* ðŸ”‘ STEP-7: UX HINT (ONLY ADDITION) */}
        <small className="text-muted d-block mb-3">
          Password must be different from last 5 passwords
        </small>

        {/* Confirm Password */}
        <input
          type="password"
          className="form-control mb-3"
          placeholder="Confirm password"
          value={confirm}
          onChange={(e) =>
            setConfirm(e.target.value)
          }
          required
        />

        <button
          className="btn btn-success w-100"
          disabled={loading}
        >
          {loading
            ? "Resetting..."
            : "Reset Password"}
        </button>
      </form>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/auth/VerifyEmail.tsx
=============================
import { useEffect } from "react";
import { useSearchParams } from "react-router-dom";
import api from "../../api/axios";

export default function VerifyEmail() {
  const [params] = useSearchParams();

  useEffect(() => {
    const id = params.get("id");
    const hash = params.get("hash");

    if (id && hash) {
      api.get(`/email/verify/${id}/${hash}`);
    }
  }, []);

  return (
    <div className="container mt-5 text-center">
      <h4>Email Verification</h4>
      <p>
        Verifying your emailâ€¦  
        You may close this page.
      </p>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/errors/NotFound.tsx
=============================
import { Link } from "react-router-dom";

export default function NotFound() {
  return (
    <div className="container mt-5 text-center">
      <h2 className="mb-3">404 â€“ Page Not Found</h2>

      <p className="text-muted">
        The page you are looking for does not exist.
      </p>

      <Link to="/login" className="btn btn-secondary mt-3">
        Go to Login
      </Link>
    </div>
  );
}



=============================
FILE: textutils-react/src/pages/errors/Unauthorized.tsx
=============================
export default function Unauthorized() {
  return (
    <div className="container text-center mt-5">
      <h1 className="text-danger">403</h1>
      <h3>Unauthorized Access</h3>
      <p>You do not have permission to access this page.</p>
    </div>
  );
}



=============================
FILE: textutils-react/src/routes/AppRoutes.tsx
=============================
import { useRoutes } from "react-router-dom";

import { authRoutes } from "./auth.routes";
import { adminRoutes } from "../admin/routes/admin.routes";
import { userRoutes } from "../user/routes/user.routes";
import { errorRoutes } from "./error.routes";

export default function AppRoutes() {
  const routes = useRoutes([
    ...authRoutes,
    ...userRoutes,
    ...adminRoutes,
    ...errorRoutes,
  ]);

  return routes;
}



=============================
FILE: textutils-react/src/routes/auth.routes.tsx
=============================
import AuthLayout from "../auth/layouts/AuthLayout";
import Login from "../pages/auth/Login";
import Register from "../pages/auth/Register";
import ForgotPassword from "../pages/auth/ForgotPassword";
import ResetPassword from "../pages/auth/ResetPassword";
import VerifyEmail from "../pages/auth/VerifyEmail";
import ResendVerification from "../pages/auth/ResendVerification";

import { RouteObject } from "react-router-dom";

export const authRoutes: RouteObject[] = [
  {
    element: <AuthLayout />,
    children: [
      { path: "/login", element: <Login /> },
      { path: "/admin/login", element: <Login admin /> },
      { path: "/register", element: <Register /> },
      { path: "/forgot-password", element: <ForgotPassword /> },
      { path: "/reset-password", element: <ResetPassword /> },
      { path: "/verify-email", element: <VerifyEmail /> },
      { path: "/email/resend", element: <ResendVerification /> },
    ],
  },
];



=============================
FILE: textutils-react/src/routes/error.routes.tsx
=============================
import Unauthorized from "../pages/errors/Unauthorized";
import NotFound from "../pages/errors/NotFound";

export const errorRoutes = [
  { path: "/admin/unauthorized", element: <Unauthorized /> },
  { path: "*", element: <NotFound /> },
];



=============================
FILE: textutils-react/src/services/authService.ts
=============================
// src/services/authService.ts

import api from "../api/axios";

/* =====================================================
   AUTH SERVICES
   -----------------------------------------------------
   RULES:
   - ONLY authentication related endpoints
   - No token mutation here
   - No refresh-token logic here
   - No admin APIs here
===================================================== */

/* ================= LOGIN ================= */
/**
 * POST /login
 *
 * Returns:
 * {
 *   token: string
 *   refresh_token?: string
 * }
 */
export const loginService = (
  email: string,
  password: string
) => {
  return api.post("/login", {
    email,
    password,
  });
};

/* ================= PROFILE ================= */
/**
 * GET /profile
 *
 * SINGLE SOURCE OF TRUTH
 * {
 *   user: User
 *   permissions: string[]
 * }
 */
export const profileService = () => {
  return api.get("/profile");
};

/* ================= LOGOUT ================= */
/**
 * POST /logout
 *
 * Best-effort backend logout
 * (frontend state already cleared)
 */
export const logoutService = () => {
  return api.post("/logout");
};

/* ================= REGISTER ================= */
/**
 * POST /register
 *
 * USER registration only
 * âŒ Admin creation NOT allowed here
 */
export const registerService = (data: {
  name: string;
  email: string;
  password: string;
  password_confirmation: string;
}) => {
  return api.post("/register", data);
};



=============================
FILE: textutils-react/src/store/api.audit.ts
=============================
import { api } from "./api";
import type { AuditLog } from "@/types/audit";
import type { PaginationMeta } from "@/types/pagination";

export const auditApi = api.injectEndpoints({
  endpoints: (builder) => ({
    getAuditLogs: builder.query<
      { data: AuditLog[]; meta: PaginationMeta },
      { page?: number; action?: string }
    >({
      query: (params) => ({
        url: "/admin/audit-logs",
        params,
      }),
      transformResponse: (res: any) => ({
        data: res.data ?? [],
        meta: res.meta,
      }),
    }),
  }),
});

export const { useGetAuditLogsQuery } = auditApi;



=============================
FILE: textutils-react/src/store/api.ts
=============================
// src/store/api.ts

import { createApi } from "@reduxjs/toolkit/query/react";
import type { User, Role, Permission } from "../types/models";
import type { PaginationMeta } from "../types/pagination";
import { baseQueryWithReauth } from "./baseQueryWithReauth";
import { buildQueryParams } from "./apiHelpers";

/* =====================================================
   API SLICE â€“ SINGLE SOURCE OF TRUTH
===================================================== */

export const api = createApi({
  reducerPath: "api",
  baseQuery: baseQueryWithReauth,

  tagTypes: [
    "Users",
    "Roles",
    "Permissions",
    "Sidebar",
    "AuditLogs",
  ],

  endpoints: (builder) => ({
    /* ================= USERS ================= */

    getUsers: builder.query<
      { data: User[]; meta: PaginationMeta },
      { page?: number; search?: string } | void
    >({
      query: (params) =>
        `/admin/users${buildQueryParams(params)}`,
      transformResponse: (res: any) => ({
        data: res.data ?? [],
        meta: res.meta,
      }),
      providesTags: [{ type: "Users", id: "LIST" }],
    }),

    createUser: builder.mutation<any, Partial<User>>({
      query: (body) => ({
        url: "/admin/users",
        method: "POST",
        body,
      }),
      invalidatesTags: ["Users"],
    }),

    deleteUser: builder.mutation<void, number>({
      query: (id) => ({
        url: `/admin/users/${id}`,
        method: "DELETE",
      }),
      invalidatesTags: ["Users"],
    }),

    restoreUser: builder.mutation<void, number>({
      query: (id) => ({
        url: `/admin/users/${id}/restore`,
        method: "POST",
      }),
      invalidatesTags: ["Users"],
    }),

    assignUserRoles: builder.mutation<
      void,
      { id: number; roles: string[] }
    >({
      query: ({ id, roles }) => ({
        url: `/admin/users/${id}/assign-role`,
        method: "POST",
        body: { roles },
      }),
      invalidatesTags: ["Users"],
    }),

    toggleUserStatus: builder.mutation<void, number>({
      query: (id) => ({
        url: `/admin/users/${id}/toggle-status`,
        method: "POST",
      }),
      invalidatesTags: ["Users"],
    }),

    forceUserPasswordReset: builder.mutation<void, number>({
      query: (id) => ({
        url: `/admin/users/${id}/force-password-reset`,
        method: "POST",
      }),
      invalidatesTags: ["Users"],
    }),

    /* ================= USER â†’ PERMISSIONS ================= */

    getUserPermissions: builder.query<
      { permissions: Permission[]; assigned: string[] },
      number
    >({
      query: (id) => `/admin/users/${id}/permissions`,
      transformResponse: (res: any) => res.data,
      providesTags: (_r, _e, id) => [{ type: "Users", id }],
    }),

    assignUserPermissions: builder.mutation<
      void,
      { id: number; permissions: string[] }
    >({
      query: ({ id, permissions }) => ({
        url: `/admin/users/${id}/permissions`,
        method: "POST",
        body: { permissions },
      }),
      invalidatesTags: (_r, _e, { id }) => [{ type: "Users", id }],
    }),

    /* ================= ROLES ================= */

    getRoles: builder.query<Role[], void>({
      query: () => "/admin/roles",
      transformResponse: (res: any) => res.data ?? [],
      providesTags: ["Roles"],
    }),

    createRole: builder.mutation<any, { name: string }>({
      query: (body) => ({
        url: "/admin/roles",
        method: "POST",
        body,
      }),
      invalidatesTags: ["Roles"],
    }),

    updateRole: builder.mutation<any, { id: number; name: string }>({
      query: ({ id, ...body }) => ({
        url: `/admin/roles/${id}`,
        method: "PUT",
        body,
      }),
      invalidatesTags: ["Roles"],
    }),

    deleteRole: builder.mutation<void, number>({
      query: (id) => ({
        url: `/admin/roles/${id}`,
        method: "DELETE",
      }),
      invalidatesTags: ["Roles"],
    }),

    /* ================= ROLE â†’ PERMISSIONS ================= */

    getRolePermissions: builder.query<
      { permissions: Permission[]; assigned: string[] },
      number
    >({
      query: (id) => `/admin/roles/${id}/permissions`,
      transformResponse: (res: any) => res.data,
      providesTags: (_r, _e, id) => [{ type: "Roles", id }],
    }),

    assignRolePermissions: builder.mutation<
      void,
      { id: number; permissions: string[] }
    >({
      query: ({ id, permissions }) => ({
        url: `/admin/roles/${id}/permissions`,
        method: "POST",
        body: { permissions },
      }),
      invalidatesTags: (_r, _e, { id }) => [{ type: "Roles", id }],
    }),

    /* ================= PERMISSIONS ================= */

  getPermissions: builder.query<Permission[], { flat?: boolean } | void>({
    query: (params) =>
      `/admin/permissions${buildQueryParams(params)}`,
    transformResponse: (res: any) => res.data ?? [],
    providesTags: ["Permissions"],
  }),

    createPermission: builder.mutation<any, { name: string }>({
      query: (body) => ({
        url: "/admin/permissions",
        method: "POST",
        body,
      }),
      invalidatesTags: ["Permissions"],
    }),

    updatePermission: builder.mutation<any, { id: number; name: string }>({
      query: ({ id, ...body }) => ({
        url: `/admin/permissions/${id}`,
        method: "PUT",
        body,
      }),
      invalidatesTags: ["Permissions"],
    }),

    deletePermission: builder.mutation<void, number>({
      query: (id) => ({
        url: `/admin/permissions/${id}`,
        method: "DELETE",
      }),
      invalidatesTags: ["Permissions"],
    }),

    /* ================= SIDEBAR ================= */

    getSidebar: builder.query<any[], void>({
      query: () => "/admin/sidebar",
      transformResponse: (res: any) => res.data ?? [],
      providesTags: ["Sidebar"],
    }),

    /* ================= DASHBOARD ================= */

    getDashboardStats: builder.query<
      { total_users: number },
      void
    >({
      query: () => "/admin/dashboard/stats",
      transformResponse: (res: any) => res.data,
    }),

    /* ================= AUDIT LOGS ================= */

    getAuditLogs: builder.query<
      { data: any[]; meta: PaginationMeta },
      { page?: number; action?: string } | void
    >({
      query: (params) =>
        `/admin/audit-logs${buildQueryParams(params)}`,
      transformResponse: (res: any) => ({
        data: res.data ?? [],
        meta: res.meta,
      }),
      providesTags: [{ type: "AuditLogs", id: "LIST" }],
    }),
  }),
});

/* =====================================================
   EXPORT HOOKS
===================================================== */

export const {
  // USERS
  useGetUsersQuery,
  useCreateUserMutation,
  useDeleteUserMutation,
  useRestoreUserMutation,
  useAssignUserRolesMutation,
  useToggleUserStatusMutation,
  useForceUserPasswordResetMutation,

  // USER â†’ PERMISSIONS
  useGetUserPermissionsQuery,
  useAssignUserPermissionsMutation,

  // ROLES
  useGetRolesQuery,
  useCreateRoleMutation,
  useUpdateRoleMutation,
  useDeleteRoleMutation,

  // ROLE â†’ PERMISSIONS
  useGetRolePermissionsQuery,
  useAssignRolePermissionsMutation,

  // PERMISSIONS âœ… FIXED
  useGetPermissionsQuery,
  useCreatePermissionMutation,
  useUpdatePermissionMutation,
  useDeletePermissionMutation,

  // SIDEBAR
  useGetSidebarQuery,

  // DASHBOARD
  useGetDashboardStatsQuery,

  // AUDIT LOGS
  useGetAuditLogsQuery,
} = api;



=============================
FILE: textutils-react/src/store/apiHelpers.ts
=============================
type QueryParams = Record<string, any>;

export function buildQueryParams(params?: QueryParams) {
  if (!params) return "";

  const query = Object.entries(params)
    .filter(([_, v]) => v !== undefined && v !== "")
    .map(
      ([k, v]) =>
        `${encodeURIComponent(k)}=${encodeURIComponent(v)}`
    )
    .join("&");

  return query ? `?${query}` : "";
}

/* standard Laravel API response */
export function extractData<T = any>(res: any): T {
  return res.data;
}



=============================
FILE: textutils-react/src/store/authSlice.ts
=============================
import {
  createSlice,
  createAsyncThunk,
  PayloadAction,
} from "@reduxjs/toolkit";

import {
  loginService,
  profileService,
} from "../services/authService";

import type { User } from "../types/models";
import { emitLogoutEvent } from "../utils/authEvents";

/* ================= TYPES ================= */

export type AuthState = {
  user: User | null;
  permissions: string[];
  token: string | null;
  loading: boolean;
  forcePasswordReset: boolean;
};

/* ================= INITIAL STATE ================= */

const initialState: AuthState = {
  user: (() => {
    try {
      return JSON.parse(localStorage.getItem("user") || "null");
    } catch {
      return null;
    }
  })(),

  permissions: (() => {
    try {
      return JSON.parse(
        localStorage.getItem("permissions") || "[]"
      );
    } catch {
      return [];
    }
  })(),

  token: localStorage.getItem("token"),
  loading: false,
  forcePasswordReset: false,
};

/* ================= LOGIN THUNK (FIXED) ================= */

export const loginThunk = createAsyncThunk<
  { token: string; force_password_reset: boolean },
  { email: string; password: string },
  {
    rejectValue: {
      message: string;
      errors?: any;
    };
  }
>("auth/login", async (data, { rejectWithValue }) => {
  try {
    const res = await loginService(
      data.email,
      data.password
    );

    return res.data.data;
  } catch (e: any) {
    const data = e.response?.data;

    return rejectWithValue({
      message:
        data?.message || "Invalid credentials",
      errors: data?.errors || null,
    });
  }
});

/* ================= PROFILE ================= */

export const fetchProfileThunk = createAsyncThunk<
  {
    user: User;
    permissions: string[];
    force_password_reset: boolean;
  },
  void,
  { rejectValue: string }
>("auth/profile", async (_, { rejectWithValue }) => {
  try {
    const res = await profileService();
    return res.data.data;
  } catch {
    return rejectWithValue(
      "Failed to load profile"
    );
  }
});

/* ================= LOGOUT ================= */

export const logoutThunk = createAsyncThunk(
  "auth/logout",
  async () => {
    localStorage.clear();
    emitLogoutEvent();
    return true;
  }
);

/* ================= SLICE ================= */

const authSlice = createSlice({
  name: "auth",
  initialState,

  reducers: {
    setPermissions(
      state,
      action: PayloadAction<string[]>
    ) {
      state.permissions = action.payload;
      localStorage.setItem(
        "permissions",
        JSON.stringify(action.payload)
      );
    },
  },

  extraReducers: (builder) => {
    builder

      /* LOGIN */
      .addCase(loginThunk.pending, (state) => {
        state.loading = true;
      })

      .addCase(
        loginThunk.fulfilled,
        (state, action) => {
          state.loading = false;
          state.token = action.payload.token;
          state.forcePasswordReset =
            action.payload.force_password_reset;

          localStorage.setItem(
            "token",
            action.payload.token
          );
        }
      )

      .addCase(loginThunk.rejected, (state) => {
        state.loading = false;
      })

      /* PROFILE */
      .addCase(
        fetchProfileThunk.fulfilled,
        (state, action) => {
          state.user = action.payload.user;
          state.permissions =
            action.payload.permissions;
          state.forcePasswordReset =
            action.payload.force_password_reset;

          localStorage.setItem(
            "user",
            JSON.stringify(action.payload.user)
          );

          localStorage.setItem(
            "permissions",
            JSON.stringify(
              action.payload.permissions
            )
          );
        }
      )

      .addCase(fetchProfileThunk.rejected, (state) => {
        state.user = null;
        state.permissions = [];
        state.forcePasswordReset = false;
      })

      /* LOGOUT */
      .addCase(
        logoutThunk.fulfilled,
        (state) => {
          state.user = null;
          state.permissions = [];
          state.token = null;
          state.loading = false;
          state.forcePasswordReset = false;
        }
      );
  },
});

export const { setPermissions } =
  authSlice.actions;

export default authSlice.reducer;



=============================
FILE: textutils-react/src/store/baseQueryWithReauth.ts
=============================
import {
  fetchBaseQuery,
  FetchArgs,
  FetchBaseQueryError,
  BaseQueryFn,
} from "@reduxjs/toolkit/query/react";
import type { RootState } from "./index";
import { logoutThunk } from "./authSlice";

/* =====================================================
   BASE QUERY
   - only attaches token
   - no side effects here
===================================================== */

const rawBaseQuery = fetchBaseQuery({
  baseUrl: import.meta.env.VITE_API_URL,
  prepareHeaders: (headers, { getState }) => {
    const token = (getState() as RootState).auth.token;

    if (token) {
      headers.set("Authorization", `Bearer ${token}`);
    }

    headers.set("Accept", "application/json");
    return headers;
  },
});

/* =====================================================
   REFRESH TOKEN LOCK (CRITICAL)
   - prevents multiple refresh calls
===================================================== */

let isRefreshing = false;
let refreshPromise: Promise<any> | null = null;

/* =====================================================
   BASE QUERY WITH RE-AUTH
===================================================== */

export const baseQueryWithReauth: BaseQueryFn<
  string | FetchArgs,
  unknown,
  FetchBaseQueryError
> = async (args, api, extraOptions) => {
  let result = await rawBaseQuery(args, api, extraOptions);

  /* ================= 401 â†’ TRY REFRESH ================= */

  if (result.error?.status === 401) {
    const refreshToken = localStorage.getItem("refresh_token");

    /* ðŸ”’ No refresh token â†’ force logout */
    if (!refreshToken) {
      api.dispatch(logoutThunk());
      return result;
    }

    /* ðŸ”’ Prevent multiple refresh calls */
    if (!isRefreshing) {
      isRefreshing = true;

      refreshPromise = rawBaseQuery(
        {
          url: "/refresh-token",
          method: "POST",
          body: { refresh_token: refreshToken },
        },
        api,
        extraOptions
      )
        .then((res: any) => {
          if (!res.data?.data?.token) {
            throw new Error("Invalid refresh response");
          }

          const { token, refresh_token } = res.data.data;

          /* ðŸ” Persist tokens */
          localStorage.setItem("token", token);
          if (refresh_token) {
            localStorage.setItem("refresh_token", refresh_token);
          }

          return token;
        })
        .catch(() => {
          api.dispatch(logoutThunk());
          throw new Error("Refresh failed");
        })
        .finally(() => {
          isRefreshing = false;
        });
    }

    try {
      /* â³ Wait for refresh to complete */
      await refreshPromise;

      /* ðŸ” Retry original request */
      result = await rawBaseQuery(args, api, extraOptions);
    } catch {
      return result;
    }
  }

  return result;
};



=============================
FILE: textutils-react/src/store/index.ts
=============================
import { configureStore } from "@reduxjs/toolkit";
import authReducer from "./authSlice";
import { api } from "./api";

export const store = configureStore({
  reducer: {
    auth: authReducer,
    [api.reducerPath]: api.reducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(api.middleware),
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;



=============================
FILE: textutils-react/src/store/storeAccessor.ts
=============================
import type { Store } from "@reduxjs/toolkit";

let store: Store | undefined;

export const setStore = (_store: Store) => {
  store = _store;
};

export const getStore = (): Store => {
  if (!store) {
    throw new Error("Redux store not initialized");
  }
  return store;
};



=============================
FILE: textutils-react/src/types/audit.ts
=============================
// src/types/audit.ts

import type { ID, Timestamp } from "./models";

/* =====================================================
   AUDIT LOG
   -----------------------------------------------------
   Matches:
   - audit_logs table
   - /admin/audit-logs API response
===================================================== */

export type AuditLog = {
  id: ID;

  /* ================= ACTOR ================= */
  user_id?: ID | null;
  user_name?: string | null;     // backend join / accessor
  user_email?: string | null;

  /* ================= ACTION ================= */
  action: string;                // login, logout, role-assigned, permission-changed
  description?: string | null;   // optional human readable text

  /* ================= TARGET ================= */
  model?: string | null;         // User, Role, Permission, etc
  model_id?: ID | null;

  /* ================= CONTEXT ================= */
  ip_address?: string | null;
  user_agent?: string | null;

  /* ================= META ================= */
  old_values?: Record<string, any> | null;
  new_values?: Record<string, any> | null;

  /* ================= TIMESTAMPS ================= */
  created_at: Timestamp;
};



=============================
FILE: textutils-react/src/types/modal.ts
=============================
import type { User, Role } from "./models";

export type ModalMap = {
  /* ================= USER ================= */

  "user-form": null;

  "user-role": User;

  "user-permission": {
    id: number;
    name: string;
  };

  /* ================= ROLE ================= */

  "role-add": null;

  "role-edit": Role;

  /* ================= PERMISSION ================= */

  "permission": {
    id?: number;
    name?: string;
  };

  /* ================= GLOBAL ================= */

  "confirm-delete": {
    message: string;
    onConfirm: () => Promise<void>;
    confirmLabel?: string; 
  };
};



=============================
FILE: textutils-react/src/types/models.ts
=============================
/* =====================================================
   COMMON
===================================================== */

export type ID = number;
export type Timestamp = string;

/* =====================================================
   USER
   -----------------------------------------------------
   Matches:
   - App\Http\Resources\UserResource
   - /profile response
   - /admin/users listing
===================================================== */

export type User = {
  id: ID;
  name: string;
  email: string;

  /* ================= RBAC ================= */
  roles: string[];                 // ["super-admin", "admin"]

  /* ================= ACCOUNT ================= */
  is_active?: boolean;
  force_password_reset?: boolean;

  /* ================= VERIFICATION ================= */
  email_verified_at?: Timestamp | null;

  /* ================= SECURITY ================= */
  last_login_at?: Timestamp | null;
  last_login_ip?: string | null;

  /* ================= SOFT DELETE ================= */
  deleted_at?: Timestamp | null;

  /* ================= META ================= */
  created_at?: Timestamp;
  updated_at?: Timestamp;
};

/* =====================================================
   ROLE
===================================================== */

export type Role = {
  id: ID;
  name: string;

  is_active?: boolean;
  deleted_at?: Timestamp | null;
};

/* =====================================================
   PERMISSION  âœ… FIXED
===================================================== */

export type Permission = {
  id: ID;
  name: string;

  /* âœ… GROUP SUPPORT */
  group_name: string;              // "User" | "Role" | "System"

  /* ================= STATUS ================= */
  is_active?: boolean;

  /* ================= SOFT DELETE ================= */
  deleted_at?: Timestamp | null;
};



=============================
FILE: textutils-react/src/types/pagination.ts
=============================
export type PaginationMeta = {
  current_page: number;
  last_page: number;
  per_page: number;
  total: number;
};



=============================
FILE: textutils-react/src/types/permission.ts
=============================
export type PermissionItem = {
  id: number;
  name: string;
};

export type GroupedPermissions = Record<string, PermissionItem[]>;



=============================
FILE: textutils-react/src/types/role.ts
=============================
export type Role = {
  id: number;
  name: string;
  parent_id?: number | null;
  is_active: boolean;
};



=============================
FILE: textutils-react/src/types/sidebar.ts
=============================
// src/types/sidebar.ts

export type SidebarItem = {
  label: string;
  path?: string;
  element?: JSX.Element;   // ðŸ”¥ ADD THIS
  permission?: string;
  action?: "logout";
};

export type SidebarGroup = {
  label: string;
  icon: string;
  showInMenu?: boolean;
  children: SidebarItem[];
};



=============================
FILE: textutils-react/src/ui/Card.tsx
=============================
import React from "react";

type Props = {
  children: React.ReactNode;
  className?: string;
};

export default function Card({ children, className = "" }: Props) {
  return (
    <div className={`card card-outline card-primary ${className}`}>
      {children}
    </div>
  );
}



=============================
FILE: textutils-react/src/ui/CardBody.tsx
=============================
export default function CardBody({
  children,
  className = "",
}: {
  children: React.ReactNode;
  className?: string;
}) {
  return <div className={`card-body ${className}`}>{children}</div>;
}



=============================
FILE: textutils-react/src/ui/CardHeader.tsx
=============================
import React from "react";

type Props = {
  title?: string;
  action?: React.ReactNode;
};

export default function CardHeader({ title, action }: Props) {
  return (
    <div className="card-header d-flex justify-content-between align-items-center">
      {title && <h3 className="card-title mb-0">{title}</h3>}
      {action}
    </div>
  );
}



=============================
FILE: textutils-react/src/ui/InfoBox.tsx
=============================
type Props = {
  title: string;
  value: string | number;
  icon: string;
  color?: "info" | "success" | "warning" | "danger" | "primary";
};

export default function InfoBox({
  title,
  value,
  icon,
  color = "info",
}: Props) {
  return (
    <div className="info-box">
      <span className={`info-box-icon bg-${color}`}>
        <i className={icon} />
      </span>

      <div className="info-box-content">
        <span className="info-box-text">{title}</span>
        <span className="info-box-number">{value}</span>
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/ui/StatCard.tsx
=============================
type Props = {
  title: string;
  value: string | number;
  icon?: string;
  color?: "primary" | "success" | "warning" | "danger" | "info" | "dark";
};

export default function StatCard({
  title,
  value,
  icon,
  color = "primary",
}: Props) {
  return (
    <div className={`card text-bg-${color}`}>
      <div className="card-body d-flex justify-content-between align-items-center">
        <div>
          <h6 className="mb-1">{title}</h6>
          <h3 className="mb-0">{value}</h3>
        </div>
        {icon && <i className={`${icon} fa-2x opacity-75`} />}
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/user/features/profile/ProfilePage.tsx
=============================
import { useEffect } from "react";
import { useAuth } from "../../../auth/hooks/useAuth";
import ProfileRoles from "./ProfileRoles";
import { useLogout } from "../../../auth/hooks/useLogout";

export default function ProfilePage() {
  const { user } = useAuth();
  const logout = useLogout();
  useEffect(() => {
    // Bootstrap tab fix (jQuery)
    // @ts-ignore
    window.$?.('[data-toggle="tab"]').tab();
  }, []);

  if (!user) {
    return (
      <div className="container mt-5 text-center text-muted">
        No profile data found
      </div>
    );
  }

  return (
    <div className="container mt-5">
      <div className="row">
        {/* ================= LEFT PROFILE CARD ================= */}
        <div className="col-md-4 mb-4">
          <div className="card shadow-sm text-center">
            <div className="card-body">
              <img
                src="https://ui-avatars.com/api/?name={user.name}&background=0d6efd&color=fff&size=128"
                className="rounded-circle mb-3"
                alt="Profile"
              />

              <h5 className="mb-1">{user.name}</h5>
              <p className="text-muted mb-2">{user.email}</p>

              <span className="badge badge-success">Active User</span>
            </div>
          </div>
        </div>

        {/* ================= RIGHT CONTENT ================= */}
        <div className="col-md-8">
          <div className="card shadow-sm">
            <div className="card-header bg-white">
              <ul className="nav nav-tabs card-header-tabs">
                <li className="nav-item">
                  <a
                    className="nav-link active"
                    data-toggle="tab"
                    href="#profile"
                  >
                    Profile Info
                  </a>
                </li>
                <li className="nav-item">
                  <a className="nav-link" data-toggle="tab" href="#roles">
                    My Roles
                  </a>
                </li>
                <li className="nav-item">
                  <a className="nav-link" data-toggle="tab" href="#settings">
                    Settings
                  </a>
                </li>
              </ul>
            </div>

            <div className="card-body tab-content">
              {/* ===== PROFILE INFO ===== */}
              <div className="tab-pane fade show active" id="profile">
                <div className="row">
                  <div className="col-md-6 mb-3">
                    <label className="text-muted">Name</label>
                    <div className="fw-bold">{user.name}</div>
                  </div>

                  <div className="col-md-6 mb-3">
                    <label className="text-muted">Email</label>
                    <div className="fw-bold">{user.email}</div>
                  </div>
                </div>
              </div>

              {/* ===== ROLES ===== */}
              <div className="tab-pane fade" id="roles">
                <ProfileRoles />
              </div>

              {/* ===== SETTINGS (PLACEHOLDER) ===== */}
              <div className="tab-pane fade" id="settings">
                <p className="text-muted">Settings section coming soon.</p>

                <button className="btn btn-outline-danger btn-sm">
                  Change Password
                </button>
                <button
                  className="btn btn-outline-danger btn-sm mt-3"
                  onClick={() => logout("/login")}
                >
                  <i className="fas fa-sign-out-alt mr-1" />
                  Logout
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}



=============================
FILE: textutils-react/src/user/features/profile/ProfileRoles.tsx
=============================
import { useAuth } from "../../../auth/hooks/useAuth";

export default function ProfileRoles() {
  const { user } = useAuth();

  if (!user?.roles?.length) {
    return (
      <p className="text-muted">
        No roles assigned to you.
      </p>
    );
  }

  return (
    <ul className="list-group list-group-flush">
      {user.roles.map((role) => (
        <li
          key={role}
          className="list-group-item d-flex justify-content-between align-items-center"
        >
          {role}
          <span className="badge badge-primary">
            Active
          </span>
        </li>
      ))}
    </ul>
  );
}



=============================
FILE: textutils-react/src/user/features/settings/SettingsPage.tsx
=============================


=============================
FILE: textutils-react/src/user/layouts/UserLayout.tsx
=============================
import { Outlet } from "react-router-dom";

export default function UserLayout() {
  return (
    <div className="container-fluid mt-3">
      <Outlet />
    </div>
  );
}



=============================
FILE: textutils-react/src/user/routes/user.routes.tsx
=============================
import AuthGuard from "../../guards/AuthGuard";
import UserLayout from "../layouts/UserLayout";

import ProfilePage from "../features/profile/ProfilePage";

export const userRoutes = [
  {
    element: <AuthGuard />,
    children: [
      {
        element: <UserLayout />,
        children: [
          { path: "/profile", element: <ProfilePage /> },
        ],
      },
    ],
  },
];



=============================
FILE: textutils-react/src/utils/authEvents.ts
=============================
const AUTH_EVENT_KEY = "__auth_event__";

export const emitLogoutEvent = () => {
  localStorage.setItem(
    AUTH_EVENT_KEY,
    JSON.stringify({
      type: "LOGOUT",
      at: Date.now(),
    })
  );
};

export const listenAuthEvents = (onLogout: () => void) => {
  window.addEventListener("storage", (e) => {
    if (e.key === AUTH_EVENT_KEY && e.newValue) {
      const payload = JSON.parse(e.newValue);
      if (payload.type === "LOGOUT") {
        onLogout();
      }
    }
  });
};



=============================
FILE: textutils-react/src/utils/authRedirect.ts
=============================
import type { User } from "../types/models";

/**
 * Resolve post-login redirect
 * ------------------------------------
 * RULES:
 * - Admin login page â†’ /admin/dashboard
 * - Normal login:
 *    - Admin â†’ /admin/dashboard
 *    - User  â†’ /profile
 */
export function resolveLoginRedirect(
  user: User | null,
  fromAdminLogin: boolean
): string {
  if (!user) return "/login";

  /**
   * ðŸ›¡ Normalize roles
   * - backend safe
   * - impersonation safe
   */
  const roles: string[] = Array.isArray(user.roles)
    ? user.roles
    : [];

  const isAdmin =
    roles.includes("super-admin") ||
    roles.includes("admin");

  /* ðŸ”¥ ADMIN LOGIN PAGE ALWAYS â†’ ADMIN */
  if (fromAdminLogin) {
    return isAdmin
      ? "/admin/dashboard"
      : "/profile";
  }

  /* ðŸ”¥ NORMAL LOGIN */
  return isAdmin
    ? "/admin/dashboard"
    : "/profile";
}



=============================
FILE: textutils-react/src/utils/buildQueryParams.ts
=============================
export function buildQueryParams(
  params?: Record<string, any>
): string {
  if (!params) return "";

  const query = Object.entries(params)
    .filter(
      ([, value]) =>
        value !== undefined &&
        value !== null &&
        value !== ""
    )
    .map(
      ([key, value]) =>
        `${encodeURIComponent(key)}=${encodeURIComponent(value)}`
    )
    .join("&");

  return query ? `?${query}` : "";
}



=============================
FILE: textutils-react/src/utils/execute.ts
=============================
// src/utils/execute.ts

import {
  handleApiError,
  handleApiSuccess,
} from "./toastHelper";

/* =====================================================
   EXECUTE
   -----------------------------------------------------
   Central async executor
   RULES:
   - Success toast ONLY once
   - Backend message preferred
   - Errors never swallowed
===================================================== */

export async function execute<T>(
  fn: () => Promise<T>,
  successFallback?: string
): Promise<T> {
  try {
    const res: any = await fn();

    /**
     * ðŸ”” Success handling
     * - If backend sends message â†’ use it
     * - Else use fallback (if provided)
     * - If neither â†’ no toast (silent success)
     */
    if (successFallback || res?.data?.message) {
      handleApiSuccess(res, successFallback);
    }

    return res;
  } catch (error) {
    /**
     * âŒ Error handling
     * - Centralized toast
     * - Let caller decide next step
     */
    handleApiError(error);
    throw error; // ðŸ”¥ NEVER swallow
  }
}



=============================
FILE: textutils-react/src/utils/resolveLoginRedirect.ts
=============================
import type { User } from "../types/models";

/**
 * resolveLoginRedirect
 * --------------------------------
 * Central login redirect logic
 */
export function resolveLoginRedirect(user: User | null) {
  if (!user) return "/login";

  const roles = user.roles ?? [];

  if (roles.includes("super-admin") || roles.includes("admin")) {
    return "/admin/dashboard";
  }

  return "/profile";
}



=============================
FILE: textutils-react/src/utils/toastHelper.ts
=============================
// src/utils/toastHelper.ts

import { toast } from "react-toastify";

/* =====================================================
   MESSAGE EXTRACTION
   -----------------------------------------------------
   Priority:
   1. Security meta (lock / attempts)
   2. Backend message
   3. First validation error
   4. Fallback
===================================================== */

function extractMessage(
  input: any,
  fallback: string
): string {
  if (!input) return fallback;

  const data =
    input?.data ??
    input?.response?.data ??
    input;

  /* =================================================
     ðŸ”’ ACCOUNT LOCK MESSAGE (HIGHEST PRIORITY)
  ================================================== */
  const lockedUntil =
    data?.errors?.meta?.locked_until;

  if (lockedUntil) {
    const time = new Date(
      lockedUntil
    ).toLocaleTimeString();

    return `Account locked till ${time}`;
  }

  /* =================================================
     âŒ ATTEMPTS LEFT MESSAGE
  ================================================== */
  const attemptsLeft =
    data?.errors?.meta?.attempts_left;

  if (attemptsLeft !== undefined) {
    return `Invalid credentials. Attempts left: ${attemptsLeft}`;
  }

  /* ===== backend message ===== */
  if (typeof data?.message === "string") {
    return data.message;
  }

  /* ===== validation errors ===== */
  if (
    data?.errors &&
    typeof data.errors === "object"
  ) {
    const firstKey = Object.keys(data.errors)[0];
    const firstError =
      firstKey && data.errors[firstKey]?.[0];

    if (firstError) {
      return firstError;
    }
  }

  return fallback;
}

/* =====================================================
   SUCCESS TOAST
===================================================== */

export const handleApiSuccess = (
  res?: any,
  fallback = "Action completed successfully"
) => {
  const message = extractMessage(res, fallback);

  if (!message) return; // silent success allowed

  toast.success(message);
};

/* =====================================================
   ERROR TOAST
===================================================== */

export const handleApiError = (
  error: any,
  fallback = "Something went wrong"
) => {
  const status =
    error?.status ??
    error?.response?.status;

  let defaultMessage = fallback;

  /* ===== auth related ===== */
  if (status === 401) {
    defaultMessage = "Please login to continue";
  } else if (status === 403) {
    defaultMessage = "You are not authorized";
  } else if (status === 423) {
    defaultMessage =
      "Account is temporarily locked";
  }

  const message = extractMessage(
    error,
    defaultMessage
  );

  toast.error(message);
};



=============================
FILE: textutils-react/index.html
=============================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/adminlte/css/adminlte.min.css" />
    <title>textutils-react</title>
  </head>
  <body class="hold-transition sidebar-mini layout-fixed">
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- <script src="/adminlte/js/adminlte.min.js"></script> -->
  </body>
</html>

